{
  "createdBy" : "sue@iacustomer.com",
  "createdDate" : null,
  "lastModifiedBy" : "sue@iacustomer.com",
  "lastModifiedDate" : null,
  "name" : "246f7968-9f4e-4051-84e7-72d67c66e2ff",
  "query" : "declare option xhive:index-debug 'true';\ndeclare option xhive:queryplan-debug 'true';\ndeclare option xhive:pathexpr-debug 'true';\n\ndeclare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sEBELN external;\ndeclare variable $sEBELP external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sEBELN, concat(\"contains($ekpo/EBELN, &apos;\", $sEBELN, \"&apos;)\" ))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\n\n(: Search the data within the Table with a join on Info Record [INFNR] :)\n(: Select * from EKPO where EBELN = '' join EKET on EKPO.EBELN = EKET.EBELN and EKPO.EBELP = EKET.EBELP :)\n\nlet $query-str := concat(\"for $ekpo in /SAP/EKPO/ROW, $ekko in /SAP/EKKO/ROW[EBELN=$ekpo/EBELN], $eket in /SAP/EKET/ROW[EBELN=$ekpo/EBELN and EBELP=$ekpo/EBELP] \", $whereClause, \" return <RS><EKPO>{ $ekpo }</EKPO><EKKO>{ $ekko }</EKKO><EKET>{$eket}</EKET></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n\tfor $rs in $main-query\n    \n    let $EINDT := sias:showdate($rs/EKET/ROW/EINDT/text())\n    let $SLFDT := sias:showdate($rs/EKET/ROW/SLFDT/text())\n    let $AEDAT := sias:showdate($rs/EKPO/ROW/AEDAT/text())\n    let $PRDAT := sias:showdate($rs/EKPO/ROW/PRDAT/text())\n    let $LEWED := sias:showdate($rs/EKPO/ROW/LEWED/text())\n    let $MEINS := sias:get_t006a($rs/EKPO/ROW/MEINS/text())\n    \nreturn\n<row id='{string($rs/EKKO/ROW/@table:id)}'>\n<column name='cEBELN'>{ $rs/EKPO/ROW/EBELN/text() }</column>\n<column name='cEBELP'>{ $rs/EKPO/ROW/EBELP/text() }</column>\n<column name='cPO'>{ $rs/EKPO/ROW/EBELN/text() } { ' ' } { $rs/EKPO/ROW/EBELP/text() }</column>\n<column name='cPSTYP'>{ $rs/EKPO/ROW/PSTYP/text() }</column>\n<column name='cKNTTP'>{ $rs/EKPO/ROW/KNTTP/text() }</column>\n<column name='cMATNR'>{ $rs/EKPO/ROW/MATNR/text() }</column>\n<column name='cMATKL'>{ $rs/EKPO/ROW/MATKL/text() }</column>\n<column name='cWERKS'>{ $rs/EKPO/ROW/WERKS/text() }</column>\n<column name='cTXZ01'>{ $rs/EKPO/ROW/TXZ01/text() }</column>\n<column name='cLGORT'>{ $rs/EKPO/ROW/LGORT/text() }</column>\n<column name='cMENGE'>{ $rs/EKPO/ROW/MENGE/text() }</column>\n<column name='cMEINS'>{ $MEINS }</column>\n<column name='cQuantity'>{ $rs/EKPO/ROW/MENGE/text() } { ' ' } { $MEINS }</column>\n<column name='cSPINF'>{ $rs/EKPO/ROW/SPINF/text() }</column>\n<column name='cNETPR'>{ $rs/EKPO/ROW/NETPR/text() }</column>\n<column name='cPEINH'>{ $rs/EKPO/ROW/PEINH/text() }</column>\n<column name='cBPRME'>{ $rs/EKPO/ROW/BPRME/text() }</column>\n<column name='cNetPrice'>{ $rs/EKPO/ROW/NETPR/text() } { ' ' } { $rs/EKKO/ROW/WAERS/text() } / { $rs/EKPO/ROW/PEINH/text() } { ' ' } { $rs/EKPO/ROW/BPRME/text() }</column>\n<column name='cSCHPR'>{ $rs/EKPO/ROW/SCHPR/text() }</column> \n<column name='cBPUMN'>{ $rs/EKPO/ROW/BPUMN/text() }</column>\n<column name='cBPUMZ'>{ $rs/EKPO/ROW/BPUMZ/text() }</column>\n<column name='cQtyConversion'>{ $rs/EKPO/ROW/BPUMN/text() } { ' ' } { $rs/EKPO/ROW/MEINS/text() } { ' <-> ' } { $rs/EKPO/ROW/BPUMZ/text() } { ' ' } { $rs/EKPO/ROW/BPRME/text() }</column>\n<column name='cPRSDR'>{ $rs/EKPO/ROW/PRSDR/text() }</column> \n<column name='cLPEIN'>{ $rs/EKET/ROW/LPEIN/text() }</column>\n<column name='cEINDT'>{ $EINDT }</column> \n<column name='cDeliveryDate'>{ $rs/EKET/ROW/LPEIN/text() } { ' ' } { $EINDT }</column>\n<column name='cSLFDT'>{ $SLFDT }</column>\n<column name='cWEBAZ'>{ $rs/EKPO/ROW/WEBAZ/text() } Days</column>\n<column name='cMAHN1'>{ $rs/EKPO/ROW/MAHN1/text() }</column>\n<column name='cMAHN2'>{ $rs/EKPO/ROW/MAHN2/text() }</column>\n<column name='cMAHN3'>{ $rs/EKPO/ROW/MAHN3/text() }</column>\n<column name='cMAHNZ'>{ $rs/EKPO/ROW/MAHNZ/text() }</column>\n<column name='cBSTAE'>{ $rs/EKPO/ROW/BSTAE/text() }</column>\n<column name='cLABNR'>{ $rs/EKPO/ROW/LABNR/text() }</column>\n<column name='cBEDNR'>{ $rs/EKPO/ROW/BEDNR/text() }</column>\n<column name='cIDNLF'>{ $rs/EKPO/ROW/IDNLF/text() }</column>\n<column name='cUNTTO'>{ $rs/EKPO/ROW/UNTTO/text() } %</column>\n<column name='cUEBTO'>{ $rs/EKPO/ROW/UEBTO/text() } %</column>\n<column name='cINSMK'>{ $rs/EKPO/ROW/INSMK/text() }</column>\n<column name='cUEBTK'>{ $rs/EKPO/ROW/UEBTK/text() }</column>\n<column name='cMWSKZ'>{ $rs/EKPO/ROW/MWSKZ/text() }</column>\n<column name='cEVERS'>{ $rs/EKPO/ROW/EVERS/text() }</column>\n<column name='cWEPOS'>{ $rs/EKPO/ROW/WEPOS/text() }</column>\n<column name='cELIKZ'>{ $rs/EKPO/ROW/ELIKZ/text() }</column>\n<column name='cWEUNB'>{ $rs/EKPO/ROW/WEUNB/text() }</column>\n<column name='cEREKZ'>{ $rs/EKPO/ROW/EREKZ/text() }</column>\n<column name='cREPOS'>{ $rs/EKPO/ROW/REPOS/text() }</column>\n<column name='cWEBRE'>{ $rs/EKPO/ROW/WEBRE/text() }</column>\n<column name='cINFNR'>{ $rs/EKPO/ROW/INFNR/text() }</column>\n<column name='cBANFN'>{ $rs/EKPO/ROW/BANFN/text() }</column> \n<column name='cBNFPO'>{ $rs/EKPO/ROW/BNFPO/text() }</column>\n<column name='cPurchReq'>{ $rs/EKPO/ROW/BANFN/text() } { ' ' } { $rs/EKPO/ROW/BNFPO/text() }</column>\n<column name='cABELN'>{ $rs/EKPO/ROW/ABELN/text() }</column>\n<column name='cABELP'>{ $rs/EKPO/ROW/ABELP/text() }</column>\n<column name='cAllocation'>{ $rs/EKPO/ROW/ABELN/text() } { ' ' } { $rs/EKPO/ROW/ABELP/text() }</column>\n<column name='cKONNR'>{ $rs/EKPO/ROW/KONNR/text() }</column>\n<column name='cKTPNR'>{ $rs/EKPO/ROW/KTPNR/text() }</column>\n<column name='cAgreement'>{ $rs/EKPO/ROW/KONNR/text() } { ' ' } { $rs/EKPO/ROW/KTPNR/text() }</column>\n<column name='cEAN11'>{ $rs/EKPO/ROW/EAN11/text() }</column>\n<column name='cANFNR'>{ $rs/EKPO/ROW/ANFNR/text() }</column>\n<column name='cANFPS'>{ $rs/EKPO/ROW/ANFPS/text() }</column>\n<column name='cRFQ'>{ $rs/EKPO/ROW/ANFNR/text() } { ' ' } { $rs/EKPO/ROW/ANFPS/text() }</column>\n<column name='cMFZHI'>{ $rs/EKPO/ROW/MFZHI/text() }</column>\n<column name='cMaxCMG'>{ $rs/EKPO/ROW/MFZHI/text() } { ' ' } { $MEINS }</column>\n<column name='cFFZHI'>{ $rs/EKPO/ROW/FFZHI/text() }</column>\n<column name='cMaxCPGQ'>{ $rs/EKPO/ROW/FFZHI/text() } { ' ' } { $rs/EKPO/ROW/BPRME/text() }</column>\n<column name='cAEDAT'>{ $AEDAT }</column>\n<column name='cNETWR'>{ $rs/EKPO/ROW/NETWR/text() }</column>\n<column name='cPLIFZ'>{ $rs/EKPO/ROW/PLIFZ/text() } Days</column>\n<column name='cREVLV'>{ $rs/EKPO/ROW/REVLV/text() }</column>\n<column name='cKOLIF'>{ $rs/EKPO/ROW/KOLIF/text() }</column>\n<column name='cSAISO'>{ $rs/EKPO/ROW/SAISO/text() }</column>\n<column name='cSAISJ'>{ $rs/EKPO/ROW/SAISJ/text() }</column>\n<column name='cSeason'>{ $rs/EKPO/ROW/SAISO/text() } { ' ' } { $rs/EKPO/ROW/SAISJ/text() }</column>\n<column name='cKANBA'>{ $rs/EKPO/ROW/KANBA/text() }</column>\n<column name='cAUREL'>{ $rs/EKPO/ROW/AUREL/text() }</column>\n<column name='cBSGRU'>{ $rs/EKPO/ROW/BSGRU/text() }</column>\n<column name='cNTGEW'>{ $rs/EKPO/ROW/NTGEW/text() }</column>\n<column name='cGEWEI'>{ $rs/EKPO/ROW/GEWEI/text() }</column>\n<column name='cNetWeight'>{ $rs/EKPO/ROW/NTGEW/text() } { ' ' } { $rs/EKPO/ROW/GEWEI/text() }</column>\n<column name='cBRGEW'>{ $rs/EKPO/ROW/BRGEW/text() }</column>\n<column name='cVOLUM'>{ $rs/EKPO/ROW/VOLUM/text() }</column>\n<column name='cVOLEH'>{ $rs/EKPO/ROW/VOLEH/text() }</column>\n<column name='cVolume'>{ $rs/EKPO/ROW/VOLUM/text() } { ' ' } { $rs/EKPO/ROW/VOLEH/text() }</column>\n<column name='cANZPU'>{ $rs/EKPO/ROW/ANZPU/text() }</column>\n<column name='cPUNEI'>{ $rs/EKPO/ROW/PUNEI/text() }</column>\n<column name='cPoints'>{ $rs/EKPO/ROW/ANZPU/text() } { ' ' } { $rs/EKPO/ROW/PUNEI/text() }</column>\n<column name='cEKKOL'>{ $rs/EKPO/ROW/EKKOL/text() }</column>\n<column name='cSKTOF'>{ $rs/EKPO/ROW/SKTOF/text() }</column>\n<column name='cLTSNR'>{ $rs/EKPO/ROW/LTSNR/text() }</column>\n<column name='cAKTNR'>{ $rs/EKPO/ROW/AKTNR/text() }</column>\n<column name='cMEPRF'>{ $rs/EKPO/ROW/MEPRF/text() }</column>\n<column name='cPRDAT'>{ $PRDAT }</column>\n<column name='cINCO1'>{ $rs/EKPO/ROW/INCO1/text() }</column>\n<column name='cINCO2'>{ $rs/EKPO/ROW/INCO2/text() }</column>\n<column name='cIncoterms'>{ $rs/EKPO/ROW/INCO1/text() } { ' ' } { $rs/EKPO/ROW/INCO2/text() }</column>\n<column name='cMHDRZ'>{ $rs/EKPO/ROW/MHDRZ/text() }</column>\n<column name='cIPRKZ'>{ $rs/EKPO/ROW/IPRKZ/text() }</column>\n<column name='cShelf'>{ $rs/EKPO/ROW/MHDRZ/text() } { ' ' } { $rs/EKPO/ROW/IPRKZ/text() }</column>\n<column name='cLEWED'>{ $LEWED }</column>\n<column name='cSSQSS'>{ $rs/EKPO/ROW/SSQSS/text() }</column>\n<column name='cLBLKZ'>{ $rs/EKPO/ROW/LBLKZ/text() }</column>\n<column name='cWAERS'>{ $rs/EKKO/ROW/WAERS/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "ME23 - Display Purchasing Document Items",
  "compositionName" : "ME23i"
}