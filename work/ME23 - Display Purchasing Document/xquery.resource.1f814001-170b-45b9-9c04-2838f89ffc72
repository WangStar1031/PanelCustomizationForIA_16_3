{
  "createdBy" : "sue@iacustomer.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "df2eb399-5332-447e-bf91-7491421d558b",
  "query" : "declare option xhive:index-debug 'true';\ndeclare option xhive:queryplan-debug 'true';\ndeclare option xhive:pathexpr-debug 'true';\n\ndeclare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sEBELN external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sEBELN, concat(\"contains($ekko/EBELN, &apos;\", $sEBELN, \"&apos;)\" ))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\n(: Search the data within the Table with a join on Info Record [EBELN] :)\n(: Select * from EKKO join EKPO on EKKO.EBELN=EKPO.EBELN :)\n\nlet $query-str := concat(\"for $ekko in /SAP/EKKO/ROW[BSTYP='F'] \", $whereClause, \" return <RS><EKKO>{ $ekko }</EKKO></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n\tfor $rs in $main-query\n    \n    let $BUKRS_name := sias:get_t001($rs/EKKO/ROW/BUKRS/text(), \"BUTXT\")\n    let $BSART_name := sias:get_t161t($rs/EKKO/ROW/BSART/text(), $rs/EKKO/ROW/BSTYP/text())\n    let $EKGRP_name := sias:get_t024($rs/EKKO/ROW/EKGRP/text(), \"EKNAM\")\n    let $EKGRP_tel := sias:get_t024($rs/EKKO/ROW/EKGRP/text(), \"EKTEL\")\n    let $EKORG_name := sias:get_t024e($rs/EKKO/ROW/EKORG/text())\n    let $LIFNR_name := sias:get_lfa1($rs/EKKO/ROW/LIFNR/text(), \"NAME1\")\n    \n    let $BEDAT := sias:showdate($rs/EKKO/ROW/BEDAT/text())\n    let $KDATB := sias:showdate($rs/EKKO/ROW/KDATB/text())\n    let $KDATE := sias:showdate($rs/EKKO/ROW/KDATE/text())\n    let $GWLDT := sias:showdate($rs/EKKO/ROW/GWLDT/text())\n    let $IHRAN := sias:showdate($rs/EKKO/ROW/IHRAN/text())\n    let $BEDAT := sias:showdate($rs/EKKO/ROW/BEDAT/text())\n    let $LIFNR := sias:trimzero($rs/EKKO/ROW/LIFNR/text())\n    let $LIFRE := sias:trimzero($rs/EKKO/ROW/LIFRE/text())\n    \n    let $CLASSN := 'BUS2012'\n    let $OBJKEY := $sEBELN\n    let $GOSCT  := count(sias:get_gosdoc($CLASSN,$OBJKEY))\n    \nreturn\n<row id='{string($rs/EINA/ROW/@table:id)}'>\n<column name='cEBELN'>{ $rs/EKKO/ROW/EBELN/text() }</column>\n<column name='cBUKRS'>{ $rs/EKKO/ROW/BUKRS/text() }</column>\n<column name='cBUKRS_name'>{ $rs/EKKO/ROW/BUKRS/text() } { ' ' } { $BUKRS_name }</column>\n<column name='cBSART'>{ $rs/EKKO/ROW/BSART/text() }</column>\n<column name='cBSART_name'>{ $rs/EKKO/ROW/BSART/text() } { ' ' } { $BSART_name }</column>\n<column name='cEKGRP'>{ $rs/EKKO/ROW/EKGRP/text() }</column>\n<column name='cEKGRP_name'>{ $rs/EKKO/ROW/EKGRP/text() } { ' ' } { $EKGRP_name } { ' ' } { $EKGRP_tel }</column>\n<column name='cEKORG'>{ $rs/EKKO/ROW/EKORG/text() }</column>\n<column name='cEKORG_name'>{ $rs/EKKO/ROW/EKORG/text() } { ' ' } { $EKORG_name }</column>\n<column name='cLIFNR'>{ $LIFNR }</column>\n<column name='cLIFNR_name'>{ $LIFNR } { ' ' } { $LIFNR_name }</column>\n<column name='cBEDAT'>{ $BEDAT }</column>\n<column name='cPINCR'>{ $rs/EKKO/ROW/PINCR/text() }</column>\n<column name='cSPRAS'>{ $rs/EKKO/ROW/SPRAS/text() }</column>\n<column name='cUPINC'>{ $rs/EKKO/ROW/UPINC/text() }</column>\n<column name='cKDATB'>{ $KDATB }</column>\n<column name='cKDATE'>{ $KDATE }</column>\n<column name='cGWLDT'>{ $GWLDT }</column>\n<column name='cABSGR'>{ $rs/EKKO/ROW/ABSGR/text() }</column>\n<column name='cZTERM'>{ $rs/EKKO/ROW/ZTERM/text() }</column>\n<column name='cWAERS'>{ $rs/EKKO/ROW/WAERS/text() }</column>\n<column name='cZBD1T'>{ $rs/EKKO/ROW/ZBD1T/text() }</column>\n<column name='cZBD2T'>{ $rs/EKKO/ROW/ZBD2T/text() }</column>\n<column name='cZBD3T'>{ $rs/EKKO/ROW/ZBD3T/text() }</column>\n<column name='cZBD1P'>{ $rs/EKKO/ROW/ZBD1P/text() }</column>\n<column name='cZBD2P'>{ $rs/EKKO/ROW/ZBD2P/text() }</column>\n<column name='cDiscountDays1'>{ $rs/EKKO/ROW/ZBD1T/text() } Days { $rs/EKKO/ROW/ZBD1P/text() } %</column>\n<column name='cDiscountDays2'>{ $rs/EKKO/ROW/ZBD2T/text() } Days { $rs/EKKO/ROW/ZBD2P/text() } %</column>\n<column name='cDiscountDays3'>{ $rs/EKKO/ROW/ZBD3T/text() } Days Net</column>\n<column name='cWKURS'>{ $rs/EKKO/ROW/WKURS/text() }</column>\n<column name='cKUFIX'>{ $rs/EKKO/ROW/KUFIX/text() }</column>\n<column name='cINCO1'>{ $rs/EKKO/ROW/INCO1/text() }</column>\n<column name='cINCO2'>{ $rs/EKKO/ROW/INCO2/text() }</column>\n<column name='cIncoterms'>{ $rs/EKKO/ROW/INCO1/text() } { ' ' } { $rs/EKKO/ROW/INCO2/text() }</column>\n<column name='cIHRAN'>{ $IHRAN }</column>\n<column name='cANGNR'>{ $rs/EKKO/ROW/ANGNR/text() }</column>\n<column name='cIHREZ'>{ $rs/EKKO/ROW/IHREZ/text() }</column>\n<column name='cUNSEZ'>{ $rs/EKKO/ROW/UNSEZ/text() }</column>\n<column name='cVERKF'>{ $rs/EKKO/ROW/VERKF/text() }</column>\n<column name='cTELF1'>{ $rs/EKKO/ROW/TELF1/text() }</column>\n<column name='cLLIEF'>{ $rs/EKKO/ROW/LLIEF/text() }</column>\n<column name='cLIFRE'>{ $LIFRE }</column>\n<column name='cAEDAT'>{ $rs/EKKO/ROW/AEDAT/text() }</column>\n<column name='cERNAM'>{ $rs/EKKO/ROW/ERNAM/text() }</column>\n<column name='cLPONR'>{ $rs/EKKO/ROW/LPONR/text() }</column>\n<column name='cSTATU'>{ $rs/EKKO/ROW/STATU/text() }</column>\n<column name='cKONNR'>{ $rs/EKKO/ROW/KONNR/text() }</column>\n<column name='cKALSM'>{ $rs/EKKO/ROW/KALSM/text() }</column>\n<column name='cFRGGR'>{ $rs/EKKO/ROW/FRGGR/text() }</column>\n<column name='cFRGSX'>{ $rs/EKKO/ROW/FRGSX/text() }</column>\n<column name='cFRGKE'>{ $rs/EKKO/ROW/FRGKE/text() }</column>\n\n<column name='cCLASSNAME'>{ $CLASSN }</column>\n<column name='cOBJKEY'>{ $OBJKEY }</column>\n<column name='cGOSCOUNT'>{ $GOSCT }</column>\n\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "ME23 - Display Purchasing Document",
  "compositionName" : "ME23"
}