{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "c2891365-c2bd-4e4c-9076-f6d208800147",
  "query" : "declare option xhive:index-debug 'true';\ndeclare option xhive:queryplan-debug 'true';\ndeclare option xhive:pathexpr-debug 'true';\n\ndeclare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sLIFNR external;\ndeclare variable $sBUKRS external;\ndeclare variable $sEKORG external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\ndeclare function local:get_meprf($MEPRF)\n{\n      if ($MEPRF = \"1\") then \"Purchase Order Date\" \n      else if ($MEPRF = \"2\") then \"Delivery Date\"\n      else if ($MEPRF = \"3\") then \"Current Date\"\n      else if ($MEPRF = \"4\") then \"Manual\"\n      else if ($MEPRF = \"5\") then \"GR Date\"\n      else \"No Control\"\n};\n\ndeclare function local:get_criterion($SKRIT)\n{\n      if ($SKRIT = \"A\") then \"By EAN\" \n      else if ($SKRIT = \"B\") then \"By material number\"\n      else if ($SKRIT = \"C\") then \"By vendor material number\"\n      else if ($SKRIT = \"D\") then \"By material group\"\n      else \"By VSR sequence number\"\n};\n\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sLIFNR, concat(\"contains($lfa1/LIFNR, &apos;\", $sLIFNR, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sBUKRS, concat(\"contains($lfb1/BUKRS, &apos;\", $sBUKRS, \"&apos;)\"))\nlet $whereClause := local:addClause($whereClause, $sEKORG, concat(\"contains($lfm1/EKORG, &apos;\", $sEKORG, \"&apos;)\"))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $lfa1 in /SAP/LFA1/ROW, $lfm1 in /SAP/LFM1/ROW[LIFNR = $lfa1/LIFNR], $lfb1 in /SAP/LFB1/ROW[LIFNR = $lfa1/LIFNR], $adrc in /SAP/ADRC/ROW[ADDRNUMBER = $lfa1/ADRNR]\", $whereClause, \"return <RS><LFA1>{ $lfa1 }</LFA1><LFM1>{ $lfm1 }</LFM1><LFB1>{ $lfb1 }</LFB1><ADRC>{ $adrc }</ADRC></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n\tfor $rs in $main-query\n    \nlet $ZUAWA := sias:get_tzunt($rs/LFB1/ROW/ZUAWA/text())\nlet $KALSK := sias:get_tmkkt($rs/LFM1/ROW/KALSK/text())\nlet $MPROK := local:get_meprf($rs/LFM1/ROW/MEPRF/text())\nlet $SKRIT := local:get_criterion($rs/LFM1/ROW/SKRIT/text())\nlet $T008T := sias:get_t008t($rs/LFB1/ROW/ZAHLS/text())\nlet $T035T := sias:get_t035t($rs/LFB1/ROW/FDGRV/text(), 'TEXTK')\nlet $TLTEXT := sias:get_tcurt($rs/LFM1/ROW/WAERS/text())\nlet $REVDB := sias:showdate($rs/LFA1/ROW/REVDB/text())\nlet $GBDAT := sias:showdate($rs/LFA1/ROW/GBDAT/text())\nlet $LIFNRtrim := sias:trimzero($rs/LFA1/ROW/LIFNR/text())\nlet $KUNNRtrim := sias:trimzero($rs/LFA1/ROW/KUNNR/text())\nlet $AKONTtrim := sias:trimzero($rs/LFB1/ROW/AKONT/text())\nlet $ZINDTtrim := sias:showdate($rs/LFB1/ROW/ZINDT/text())\nlet $DATLZtrim := sias:showdate($rs/LFB1/ROW/DATLZ/text())\nlet $QSZDTtrim := sias:showdate($rs/LFB1/ROW/QSZDT/text())\nlet $CERDTtrim := sias:showdate($rs/LFB1/ROW/CERDT/text())\nlet $WEBTRcurrency := sias:currency($rs/LFB1/ROW/WEBTR/text(),'')\nlet $MINBWcurrency := sias:currency($rs/LFM1/ROW/MINBW/text(), '')\nlet $T005T := sias:get_t005t($rs/T005T/ROW/LANDX/text(),'LANDX')\nlet $T005U := sias:get_t005u($rs/T005U/ROW/BEZEI/text(),$rs/T005T/ROW/LANDX/text())\nlet $T001 := sias:get_t001($rs/T001/ROW/WAERS/text(), 'WAERS')\nlet $LIFNR := sias:trimzero($rs/LFA1/ROW/LIFNR/text())\n    \n    \n    \nreturn\n<row id='{string($rs/LFA1/ROW/@table:id)}'>\n\n<column name='cLIFNRtrim'>{ $LIFNRtrim }</column>\n<column name='cKUNNRtrim'>{ $KUNNRtrim }</column>\n<column name='cLIFNR_'>{ $LIFNRtrim }</column>\n\n\n\n<column name='cTITLE'>{ $rs/ADRC/ROW/TITLE/text() }</column>\n<column name='cNAME1'>{ $rs/LFA1/ROW/NAME1/text() }</column>\n<column name='cSTRAS'>{ $rs/LFA1/ROW/STRAS/text() }</column>\n<column name='cPOSHS'>{ $rs/LFA1/ROW/ADRNR/text() }</column>\n<column name='cPSTLZ'>{ $rs/LFA1/ROW/PSTLZ/text() }</column>\n<column name='cORT01'>{ $rs/LFA1/ROW/ORT01/text() }</column>\n<column name='cLAND1'>{ $rs/LFA1/ROW/LAND1/text() }{'      '}{ $T005T }</column>\n<column name='cREGIO'>{ $rs/LFA1/ROW/REGIO/text() }{'      '}{ $T005U }</column>\n<column name='cPFACH'>{ $rs/LFA1/ROW/PFACH/text() }</column>\n<column name='cPSTL2'>{ $rs/LFA1/ROW/PSTLZ/text() }</column>\n<column name='cSPRAS'>{ $rs/LFA1/ROW/SPRAS/text() }</column>\n<column name='cTELF1'>{ $rs/LFA1/ROW/TELF1/text() }</column>\n<column name='cTEL_EXTENS'>{ $rs/ADR2/ROW/TEL_EXTENS/text() }</column>\n<column name='cFAX_EXTENS'>{ $rs/ADR3/ROW/FAX_EXTENS/text() }</column>\n<column name='cSMTP_ADDR'>{ $rs/ADR6/ROW/SMTP_ADDR/text() }</column>\n<column name='cEXTENSION1'>{ $rs/ADRC/ROW/EXTENSION1/text() }</column>\n<column name='cEXTENSION2'>{ $rs/ADRC/ROW/EXTENSION2/text() }</column>\n\n<column name='cLIFNR'>{ $rs/LFA1/ROW/LIFNR/text() }</column>\n<column name='cNAME1'>{ $rs/LFA1/ROW/NAME1/text() }</column>\n<column name='cORT01'>{ $rs/LFA1/ROW/ORT01/text() }</column>\n<column name='cBUKRS'>{ $rs/LFB1/ROW/BUKRS/text() }</column>\n<column name='cEKORG'>{ $rs/LFM1/ROW/EKORG/text() }</column>\n<column name='cKUNNR'>{ $rs/LFA1/ROW/KUNNR/text() }</column>\n<column name='cVBUND'>{ $rs/LFA1/ROW/VBUND/text() }</column>\n<column name='cBEGRU'>{ $rs/LFA1/ROW/BEGRU/text() }</column>\n<column name='cKONZS'>{ $rs/LFA1/ROW/KONZS/text() }</column>\n<column name='cSTCD1'>{ $rs/LFA1/ROW/STCD1/text() }</column>\n<column name='cSTCD2'>{ $rs/LFA1/ROW/STCD2/text() }</column>\n<column name='cSTCD3'>{ $rs/LFA1/ROW/STCD3/text() }</column>\n<column name='cSTCD4'>{ $rs/LFA1/ROW/STCD4/text() }</column>\n<column name='cFISKN'>{ $rs/LFA1/ROW/FISKN/text() }</column>\n<column name='cSTCDT'>{ $rs/LFA1/ROW/STCDT/text() }</column>\n<column name='cFITYP'>{ $rs/LFA1/ROW/FITYP/text() }</column>\n<column name='cTXJCD'>{ $rs/LFA1/ROW/TXJCD/text() }</column>\n<column name='cTAX'>{ $rs/LFA1/ROW/TXJCD/text() }</column>\n<column name='cJ_1KFREPRE'>{ $rs/LFA1/ROW/J_1KFREPRE/text() }</column>\n<column name='cFISKN'>{ $rs/LFA1/ROW/FISKN/text() }</column>\n<column name='cSTENR'>{ $rs/LFA1/ROW/STENR/text() }</column>\n<column name='cACTSS'>{ $rs/LFA1/ROW/ACTSS/text() }</column>\n<column name='cSTCEG'>{ $rs/LFA1/ROW/STCEG/text() }</column>\n<column name='cJ_1KFTBUS'>{ $rs/LFA1/ROW/J_1KFTBUS/text() }</column>\n<column name='cJ_1KFTIND'>{ $rs/LFA1/ROW/J_1KFTIND/text() }</column>\n<column name='cSTKZA'>{ $rs/LFA1/ROW/STKZA/text() }</column>\n<column name='cSTKZN'>{ $rs/LFA1/ROW/STKZN/text() }</column>\n<column name='cSTKZU'>{ $rs/LFA1/ROW/STKZU/text() }</column>\n<column name='cIPISP'>{ $rs/LFA1/ROW/IPISP/text() }</column>\n<column name='cREGSS'>{ $rs/LFA1/ROW/REGSS/text() }</column>\n<column name='cBBBNR'>{ $rs/LFA1/ROW/BBBNR/text() }</column>\n<column name='cKRAUS'>{ $rs/LFA1/ROW/KRAUS/text() }</column>\n<column name='cBRSCH'>{ $rs/LFA1/ROW/BRSCH/text() }</column>\n<column name='cSCACD'>{ $rs/LFA1/ROW/SCACD/text() }</column>\n<column name='cLZONE'>{ $rs/LFA1/ROW/LZONE/text() }</column>\n<column name='cPODKZB'>{ $rs/LFA1/ROW/PODKZB/text() }</column>\n<column name='cQSSYS'>{ $rs/LFA1/ROW/QSSYS/text() }</column>\n<column name='cEMNFR'>{ $rs/LFA1/ROW/EMNFR/text() }</column>\n<column name='cBBSNR'>{ $rs/LFA1/ROW/BBSNR/text() }</column>\n<column name='cREVDB'>{ $REVDB }</column>\n<column name='cBAHNS'>{ $rs/LFA1/ROW/BAHNS/text() }</column>\n<column name='cSFRGR'>{ $rs/LFA1/ROW/SFRGR/text() }</column>\n<column name='cQSSYSDAT'>{ $rs/LFA1/ROW/QSSYSDAT/text() }</column>\n<column name='cBUBKZ'>{ $rs/LFA1/ROW/BUBKZ/text() }</column>\n<column name='cDLGRP'>{ $rs/LFA1/ROW/DLGRP/text() }</column>\n<column name='cGBDAT'>{ $GBDAT }</column>\n<column name='cGBORT'>{ $rs/LFA1/ROW/GBORT/text() }</column>\n<column name='cSEXKZ'>{ $rs/LFA1/ROW/SEXKZ/text() }</column>\n<column name='cPROFS'>{ $rs/LFA1/ROW/PROFS/text() }</column>\n\n<column name='cAKONT'>{ $AKONTtrim }</column>\n<column name='cLNRZE'>{ $rs/LFB1/ROW/LNRZE/text() }</column>\n<column name='cBEGRU'>{ $rs/LFB1/ROW/BEGRU/text() }</column>\n<column name='cMINDK'>{ $rs/LFB1/ROW/MINDK/text() }</column>\n<column name='cKey'>{ $rs/LFB1/ROW/ZUAWA/text() }{'     '} {'    Description: '} { $ZUAWA }</column>\n<column name='cBLNKZ'>{ $rs/LFB1/ROW/BLNKZ/text() }</column>\n<column name='cCash'>{ $rs/LFB1/ROW/FDGRV/text() } {'   '} { $T035T }</column>\n<column name='cFRGRP'>{ $rs/LFB1/ROW/FRGRP/text() }</column>\n<column name='cCERDT'>{ $CERDTtrim }</column>\n<column name='cVZSKZ'>{ $rs/LFB1/ROW/VZSKZ/text() }</column>\n<column name='cZINRT'>{ $rs/LFB1/ROW/ZINRT/text() }</column>\n<column name='cZINDT'>{ $ZINDTtrim }</column>\n<column name='cDATLZ'>{ $DATLZtrim }</column>\n<column name='cQSSKZ'>{ $rs/LFB1/ROW/QSSKZ/text() }</column>\n<column name='cQLAND'>{ $rs/LFB1/ROW/QLAND/text() }</column>\n<column name='cQSREC'>{ $rs/LFB1/ROW/QSREC/text() }</column>\n<column name='cQSZNR'>{ $rs/LFB1/ROW/QSZNR/text() }</column>\n<column name='cQSZDT'>{ $QSZDTtrim }</column>\n<column name='cQSBGR'>{ $rs/LFB1/ROW/QSBGR/text() }</column>\n<column name='cALTKN'>{ $rs/LFB1/ROW/ALTKN/text() }</column>\n<column name='cPERNR'>{ $rs/LFB1/ROW/PERNR/text() }</column>\n<column name='cGRICD'>{ $rs/LFB1/ROW/GRICD/text() }</column>\n<column name='cGRIDT'>{ $rs/LFB1/ROW/GRIDT/text() }</column>\n\n<column name='cZTERM'>{ $rs/LFB1/ROW/ZTERM/text() }</column>\n<column name='cGUZTE'>{ $rs/LFB1/ROW/GUZTE/text() }</column>\n<column name='cKULTG'>{ $rs/LFB1/ROW/KULTG/text() }</column>\n<column name='cTOGRU'>{ $rs/LFB1/ROW/TOGRU/text() }</column>\n<column name='cREPRF'>{ $rs/LFB1/ROW/REPRF/text() }</column>\n<column name='cZWELS'>{ $rs/LFB1/ROW/ZWELS/text() }</column>\n<column name='cLNRZB'>{ $rs/LFB1/ROW/LNRZB/text() }</column>\n<column name='cXPORE'>{ $rs/LFB1/ROW/XPORE/text() }</column>\n<column name='cXVERR'>{ $rs/LFB1/ROW/XEVRRC/text() }</column>\n<column name='cLimit'>{ $WEBTRcurrency } {'      '} { $T001 }</column>\n<column name='cXEDIP'>{ $rs/LFB1/ROW/XEDIP/text() }</column>\n<column name='cPayment'>{ $rs/LFB1/ROW/ZAHLS/text() } {'      '}{ $T008T }</column>\n<column name='cZAHLS'>{ $rs/LFB1/ROW/ZAHLS/text() }</column>\n<column name='cHBKID'>{ $rs/LFB1/ROW/HBKID/text() }</column>\n<column name='cZGRUP'>{ $rs/LFB1/ROW/ZGRUP/text() }</column>\n<column name='cXLFZB'>{ $rs/LFB1/ROW/XLFZB/text() }</column>\n<column name='cTOGRR'>{ $rs/LFB1/ROW/TOGRR/text() }</column>\n\n<column name='cOrder'>{ $rs/LFM1/ROW/WAERS/text() } { '     ' } { $TLTEXT }</column>\n<column name='cZTERM2'>{ $rs/LFM1/ROW/ZTERM/text() }</column>\n<column name='cInco'>{ $rs/LFM1/ROW/INCO1/text() } {'     '} { $rs/LFM1/ROW/INCO2/text() }</column>\n<column name='cMINBW'>{ $MINBWcurrency }</column>\n<column name='cSchema'>{ $rs/LFM1/ROW/KALSK/text() } { '     ' } { $KALSK }</column>\n<column name='cPricing'>{ $rs/LFM1/ROW/MEPRF/text() }{ $MPROK }</column>\n<column name='cBOPNR'>{ $rs/LFM1/ROW/BOPNR/text() }</column>\n<column name='cVERKF'>{ $rs/LFM1/ROW/VERKF/text() }</column>\n<column name='cTELF12'>{ $rs/LFM1/ROW/TELF1/text() }</column>\n<column name='cEIKTO'>{ $rs/LFM1/ROW/EIKTO/text() }</column>\n<column name='cWEBRE'>{ $rs/LFM1/ROW/WEBRE/text() }</column>\n<column name='cZERSY'>{ $rs/LFM1/ROW/ZERSY/text() }</column>\n<column name='cXERSR'>{ $rs/LFM1/ROW/XERSR/text() }</column>\n<column name='cKZABS'>{ $rs/LFM1/ROW/KZABS/text() }</column>\n<column name='cKZAUT'>{ $rs/LFM1/ROW/KZAUT/text() }</column>\n<column name='cBOLRE'>{ $rs/LFM1/ROW/BOLRE/text() }</column>\n<column name='cBOIND'>{ $rs/LFM1/ROW/BOIND/text() }</column>\n<column name='cUMSAE'>{ $rs/LFM1/ROW/UMSAE/text() }</column>\n<column name='cBLIND'>{ $rs/LFM1/ROW/BLIND/text() }</column>\n<column name='cKZRET'>{ $rs/LFM1/ROW/KZRET/text() }</column>\n<column name='cLEBRE'>{ $rs/LFM1/ROW/LEBRE/text() }</column>\n<column name='cLFABC'>{ $rs/LFM1/ROW/LFABC/text() }</column>\n<column name='cEXPUZ'>{ $rs/LFM1/ROW/EXPUZ/text() }</column>\n<column name='cZOLLA'>{ $rs/LFM1/ROW/ZOLLA/text() }</column>\n<column name='cCriterion'>{ $rs/LFM1/ROW/SKRIT/text() } { '    ' } { $SKRIT }</column>\n<column name='cPAPRF'>{ $rs/LFM1/ROW/PAPRF/text() }</column>\n<column name='cXNBWY'>{ $rs/LFM1/ROW/XNBWY/text() }</column>\n<column name='cNREGW'>{ $rs/LFM1/ROW/NREGW/text() }</column>\n<column name='cPRFRE'>{ $rs/LFM1/ROW/PRFRE/text() }</column>\n<column name='cAGREL'>{ $rs/LFM1/ROW/AGREL/text() }</column>\n<column name='cVSBED'>{ $rs/LFM1/ROW/VSBED/text() }</column>\n<column name='cVENDOR_RMA_REQ'>{ $rs/LFM1/ROW/VENDOR_RMA_REQ/text() }</column>\n<column name='cEKGRP'>{ $rs/LFM1/ROW/EKGRP/text() }</column>\n<column name='cPLIFZ'>{ $rs/LFM1/ROW/PLIFZ/text() } Day(s)</column>\n<column name='cBSTAE'>{ $rs/LFM1/ROW/BSTAE/text() }</column>\n<column name='cMEGRU'>{ $rs/LFM1/ROW/MEGRU/text() }</column>\n<column name='cRDPRF'>{ $rs/LFM1/ROW/RDPRF/text() }</column>\n<column name='cLIPRE'>{ $rs/LFM1/ROW/LIPRE/text() }</column>\n<column name='cLISER'>{ $rs/LFM1/ROW/LISER/text() }</column>\n<column name='cLIBES'>{ $rs/LFM1/ROW/LIBES/text() }</column>\n<column name='cVENSL'>{ $rs/LFM1/ROW/VENSL/text() }</column>\n\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "XK03 - Display Vendor",
  "compositionName" : "XK03"
}