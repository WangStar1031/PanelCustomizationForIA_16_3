{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "d20a6dee-7a93-49fc-ab1c-dc460888a875",
  "query" : "declare option xhive:index-debug 'true';\ndeclare option xhive:queryplan-debug 'true';\ndeclare option xhive:pathexpr-debug 'true';\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\ndeclare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sLIFNR external;\ndeclare variable $sBUKRS external;\ndeclare variable $sEKORG external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sLIFNR, concat(\"contains($lfa1/LIFNR, &apos;\", $sLIFNR, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sBUKRS, concat(\"contains($lfb1/BUKRS, &apos;\", $sBUKRS, \"&apos;)\"))\nlet $whereClause := local:addClause($whereClause, $sEKORG, concat(\"contains($lfm1/EKORG, &apos;\", $sEKORG, \"&apos;)\"))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $lfa1 in /SAP/LFA1/ROW, $lfm1 in /SAP/LFM1/ROW[LIFNR = $lfa1/LIFNR], $lfb1 in /SAP/LFB1/ROW[LIFNR = $lfa1/LIFNR], $lfbk in /SAP/LFBK/ROW[LIFNR = $lfa1/LIFNR], $bnka in /SAP/BNKA/ROW[BANKL = $lfbk/BANKL]\", $whereClause, \"return <RS><LFA1>{ $lfa1 }</LFA1><LFM1>{ $lfm1 }</LFM1><BNKA>{ $bnka }</BNKA><LFB1>{ $lfb1 }</LFB1><LFBK>{ $lfbk }</LFBK></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n\tfor $rs in $main-query\n    \nlet $LIFNRside := sias:trimzero($rs/LFA1/ROW/LIFNR/text())\n    \nreturn\n<row id='{string($rs/LFA1/ROW/@table:id)}'>\n<column name='cBUKRSside'>{ $rs/LFB1/ROW/BUKRS/text() }</column>\n<column name='cLIFNRside'>{ $LIFNRside }</column>\n<column name='cPORGside'>{ $rs/LFM1/ROW/EKORG/text() }</column>\n<column name='cNAMEside'>{ $rs/LFA1/ROW/NAME1/text() }</column>\n<column name='cCITYside'>{ $rs/LFA1/ROW/ORT01/text() }</column>\n\n<column name='cBUKRS'>{ $rs/LFB1/ROW/BUKRS/text() }</column>\n<column name='cLIFNR'>{ $rs/LFA1/ROW/LIFNR/text() }</column>\n<column name='cEKORG'>{ $rs/LFM1/ROW/EKORG/text() }</column>\n\n<column name='cBANKS'>{ $rs/LFBK/ROW/BANKS/text() }</column>\n<column name='cBANKL'>{ $rs/LFBK/ROW/BANKL/text() }</column>\n<column name='cBANKN'>{ $rs/LFBK/ROW/BANKN/text() }</column>\n<column name='cKOINH'>{ $rs/LFBK/ROW/KOINH/text() }</column>\n<column name='cBKONT'>{ $rs/LFBK/ROW/BKONT/text() }</column>\n<column name='cBVTYP'>{ $rs/LFBK/ROW/BVTYP/text() }</column>\n<column name='cBKREF'>{ $rs/LFBK/ROW/BKREF/text() }</column>\n<column name='cXEZER'>{ $rs/LFBK/ROW/XEZER/text() }</column>\n<column name='cLNRZA'>{ $rs/LFA1/ROW/LNRZA/text() }</column>\n<column name='cDTAMS'>{ $rs/LFA1/ROW/DTAMS/text() }</column>\n<column name='cDTAWS'>{ $rs/LFA1/ROW/DTAWS/text() }</column>\n<column name='cESRNR'>{ $rs/LFA1/ROW/ESRNR/text() }</column>\n<column name='cBANKA'>{ $rs/BNKA/ROW/BANKA/text() }</column>\n<column name='cPROVZ'>{ $rs/BNKA/ROW/PROVZ/text() }</column>\n<column name='cSTRAS'>{ $rs/BNKA/ROW/STRAS/text() }</column>\n<column name='cORT01'>{ $rs/BNKA/ROW/ORT01/text() }</column>\n<column name='cBRNCH'>{ $rs/BNKA/ROW/BRNCH/text() }</column>\n<column name='cSWIFT'>{ $rs/BNKA/ROW/SWIFT/text() }</column>\n<column name='cBGRUP'>{ $rs/BNKA/ROW/BGRUP/text() }</column>\n<column name='cXPGRO'>{ $rs/BNKA/ROW/XPGRO/text() }</column>\n<column name='cBNKLZ'>{ $rs/BNKA/ROW/BNKLZ/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "XK03 - Vendor Transaction",
  "compositionName" : "XK03"
}