{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "4d2d2608-cdc4-463a-9482-74b6f282bc95",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n\ndeclare variable $page external;\ndeclare variable $size external;\n\ndeclare variable $sMATNR external;\ndeclare variable $sKLART external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> \n  {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\ndeclare function local:get_swor($clint)\n{\nfor $swor in /SAP/SWOR/ROW[CLINT = $clint and SPRAS = 'EN']\nreturn $swor/KSCHL/text()\n};\n\n\nlet $whereClause := local:addClause(\"\", $sMATNR, concat(\"$kssk/OBJEK = &apos;\", $sMATNR, \"&apos;\" ))\nlet $whereClause := local:addClause($whereClause, $sKLART, concat(\"$kssk/KLART = &apos;\", $sKLART, \"&apos;\")) \nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $kssk in /SAP/KSSK/ROW,$klah in /SAP/KLAH/ROW[CLINT = $kssk/CLINT] \", $whereClause, \" and $kssk/MAFID = 'O' return <RS><KSSK>{ $kssk }</KSSK><KLAH>{ $klah }</KLAH></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n               for $rs in $main-query\n              let $swor := local:get_swor($rs/KSSK/ROW/CLINT/text())\n              \n              \nreturn\n<row id='{string($rs/KSSK/ROW/@table:id)}'> \n<column name='cMATNR'>{ $sMATNR }</column>\n<column name='cKLART'>{ $sKLART }</column>\n\n<column name='cCLASS'>{ $rs/KLAH/ROW/CLASS/text() }</column>\n<column name='cKSCHL'>{ $swor }</column>\n<column name='cSTDCL'>{ $rs/KSSK/ROW/STDCL/text() }</column>\n<column name='cSTATU'>{ $rs/KSSK/ROW/STATU/text() }</column>\n<column name='cZAEHL'>{ $rs/KSSK/ROW/ZAEHL/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)\n",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "MM03 - Classification",
  "compositionName" : "MM03 - Classification"
}