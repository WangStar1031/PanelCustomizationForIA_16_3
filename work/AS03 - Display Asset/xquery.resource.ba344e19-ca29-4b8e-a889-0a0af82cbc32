{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "c920cf77-4a0a-4816-ab02-919181b5bedd",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n\ndeclare variable $page external;\ndeclare variable $size external;\n\ndeclare variable $sANLN1 external;\ndeclare variable $sANLN2 external;\ndeclare variable $sBUKRS external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> \n  {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n\nlet $whereClause := local:addClause(\"\", $sANLN1, concat(\"contains($anla/ANLN1, &apos;\", $sANLN1, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sBUKRS, concat(\"$anla/BUKRS = &apos;\", $sBUKRS, \"&apos;\"))\nlet $whereClause := local:addClause($whereClause, $sANLN2, concat(\"contains($anla/ANLN2, &apos;\", $sANLN2, \"&apos;)\"))  \nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $anla in /SAP/ANLA/ROW,$anlz in /SAP/ANLZ/ROW[BUKRS = $anla/BUKRS and ANLN1 = $anla/ANLN1 and ANLN2 = $anla/ANLN2],$vibdbe in /SAP/VIBDBE/ROW[BUKRS = $anla/BUKRS and IMKEY = $anlz/IMKEY],$anlh in /SAP/ANLH/ROW[BUKRS = $anla/BUKRS and ANLN1 = $anla/ANLN1],$lfa1 in /SAP/LFA1/ROW[LIFNR = $anla/LIFNR] \", $whereClause, \" return <RS><ANLA>{ $anla }</ANLA><ANLZ>{ $anlz }</ANLZ><VIBDBE>{ $vibdbe }</VIBDBE><ANLH>{ $anlh }</ANLH><LFA1>{ $lfa1 }</LFA1></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n               for $rs in $main-query\n               let $TKOGR := sias:get_t095t($rs/ANLA/ROW/KTOGR/text())\n               let $MSEHI := sias:get_t006a($rs/ANLA/ROW/MEINS/text(), \"MSEHL\")\n               let $GSBER := sias:get_tgsbt($rs/ANLZ/ROW/GSBER/text())\n               let $WERKS := sias:get_t001w($rs/ANLZ/ROW/WERKS/text())\n               let $STORT := sias:get_t499s($rs/ANLZ/ROW/WERKS/text(), $rs/ANLZ/ROW/STORT/text(), \"KTEXT\")\n               let $ORD41 := sias:get_t087t(\"1\", $rs/ANLA/ROW/ORD41/text())\n               let $ORD42 := sias:get_t087t(\"2\", $rs/ANLA/ROW/ORD42/text())\n               let $ORD43 := sias:get_t087t(\"3\", $rs/ANLA/ROW/ORD43/text())\n               let $ORD44 := sias:get_t087t(\"4\", $rs/ANLA/ROW/ORD44/text())\n               let $IZWEK := sias:get_t087j($rs/ANLA/ROW/IZWEK/text())\n               let $UMWKZ := sias:get_t087l($rs/ANLA/ROW/UMWKZ/text())\n               let $ANLUE := sias:get_t087v($rs/ANLA/ROW/ANLUE/text())\n               let $VBUND := sias:get_t880($rs/ANLA/ROW/VBUND/text(), \"NAME1\")\n               let $LAND1 := sias:get_t005t($rs/ANLA/ROW/LAND1/text(), \"LANDX\")\n               let $WAERS := sias:get_t001($rs/ANLA/ROW/BUKRS/text(), \"WAERS\")\n               let $VMGLI := sias:get_t092t($rs/ANLA/ROW/VMGLI/text())\n               let $EIGKZ := sias:get_t097t($rs/ANLA/ROW/EIGKZ/text())\n               let $GRUND := sias:get_t098t($rs/ANLA/ROW/GRUND/text())\n               let $VSART := sias:get_t099t($rs/ANLV/ROW/VSART/text())\n               let $VSGES := sias:get_t099u($rs/ANLV/ROW/VSGES/text())\n               let $VSTAR := sias:get_t099v($rs/ANLV/ROW/VSTAR/text())\n               let $VSIND := sias:get_t094t($rs/ANLV/ROW/VSIND/text())\n               let $VRSBA := sias:get_t093b($rs/ANLA/ROW/BUKRS/text(),$rs/ANLB/ROW/AFABE/text(), \"WAERS\")\n               let $FKBER := sias:get_tfkbt($rs/ANLZ/ROW/FKBER/text())\n               let $ANLKL := sias:trimzero($rs/ANLA/ROW/ANLKL/text())\n               let $KTOGR := sias:trimzero($rs/ANLA/ROW/KTOGR/text())\n               let $AKTIV := sias:showdate($rs/ANLA/ROW/AKTIV/text())\n               let $DEAKT := sias:showdate($rs/ANLA/ROW/DEAKT/text())\n               let $ZUGDT := sias:showdate($rs/ANLA/ROW/ZUGDT/text())\n               let $GPLAB := sias:showdate($rs/ANLA/ROW/GPLAB/text())\n               let $ZUJHR := sias:showdate($rs/ANLA/ROW/ZUJHR/text())\n               let $BSTDT := sias:showdate($rs/ANLA/ROW/BSTDT/text())\n               let $ADATU := sias:showdate($rs/ANLZ/ROW/ADATU/text())\n               let $BDATU := sias:showdate($rs/ANLZ/ROW/BDATU/text())\n               let $FKBER := sias:trimzero($rs/ANLZ/ROW/FKBER/text())\n               let $IMKEY := sias:trimzero($rs/ANLZ/ROW/IMKEY/text())\n               let $LIFNR := sias:trimzero($rs/ANLA/ROW/LIFNR/text())\n               let $ANLN1 := sias:trimzero($rs/ANLA/ROW/ANLN1/text())\n\n               \n    \nreturn\n<row id='{string($rs/ANLA/ROW/@table:id)}'> \n<column name='cANLN1'>{$ANLN1 }</column>\n<column name='cANLN12'>{ $ANLN1 } { ' ' } { $rs/ANLA/ROW/ANLN2/text() } { ' ' } { $rs/ANLA/ROW/TXT50/text() }</column>\n<column name='cANLKL'>{ $ANLKL } { ' ' } { $rs/ANLA/ROW/TXK20/text() }</column>\n<column name='cBUKRS'>{ $rs/ANLA/ROW/BUKRS/text() }</column>\n\n<column name='cTXT50'>{ $rs/ANLA/ROW/TXT50/text() } { ' ' } { $rs/ANLA/ROW/TXA50 }</column>\n<column name='cANLHTXT'>{ $rs/ANLH/ROW/ANLHTXT/text() }</column>\n<column name='cKTOGR'>{ $KTOGR } { ' ' } { $TKOGR }</column>\n<column name='cSERNR'>{ $rs/ANLA/ROW/SERNR/text() }</column>\n<column name='cINVNR'>{ $rs/ANLA/ROW/INVNR/text() }</column>\n<column name='cMENGE'>{ $rs/ANLA/ROW/MENGE/text() } { ' ' } { $rs/ANLA/ROW/MEINS/text() } { ' ' } { $MSEHI }</column>\n<column name='cANEQK'>{ $rs/ANLA/ROW/ANEQK/text() }</column>\n<column name='cAKTIV'>{ $AKTIV }</column>\n<column name='cDEAKT'>{ $DEAKT }</column>\n<column name='cZUGDT'>{ $ZUGDT }</column>\n<column name='cGPLAB'>{ $GPLAB }</column>\n<column name='cZUJHR'>{ $ZUJHR } { ' ' } { $rs/ANLA/ROW/ZUPER/text() }</column>\n<column name='cBSTDT'>{ $BSTDT }</column>\n\n\n<column name='cADATU'>{ $ADATU }</column>\n<column name='cBDATU'>{ $BDATU }</column>\n<column name='cGSBER'>{ $rs/ANLZ/ROW/GSBER/text() } { ' ' } { $GSBER }</column>\n<column name='cKOSTL'>{ $rs/ANLZ/ROW/KOSTL/text() } { ' ' } { $rs/CSKT/ROW/KTEXT/text() }</column>\n<column name='cCAUFN'>{ $rs/ANLZ/ROW/CAUFN/text() } { ' ' } { $rs/AUFK/ROW/KTEXT/text() }</column>\n<column name='cIAUFN'>{ $rs/ANLZ/ROW/IAUFN/text() } { ' ' } { $rs/AUFK/ROW/KTEXT/text() }</column>\n<column name='cWERKS'>{ $rs/ANLZ/ROW/WERKS/text() } { ' ' } { $WERKS }</column>\n<column name='cSTORT'>{ $rs/ANLZ/ROW/STORT/text() } { ' ' } { $STORT }</column>\n<column name='cRAUMN'>{ $rs/ANLZ/ROW/RAUMN/text() }</column>\n<column name='cTXJCD'>{ $rs/ANLZ/ROW/TXJCD/text() }</column>\n<column name='cFKBER'>{ $FKBER } { ' ' } { $FKBER }</column>\n<column name='cIMKEY'>{ $IMKEY } { ' ' } { $rs/VIBDBE/ROW/XWETEXT/text() }</column>\n\n<column name='cORD41'>{ $rs/ANLA/ROW/ORD41/text() } { ' ' } { $ORD41 }</column>\n<column name='cORD42'>{ $rs/ANLA/ROW/ORD42/text() } { ' ' } { $ORD42 }</column>\n<column name='cORD43'>{ $rs/ANLA/ROW/ORD43/text() } { ' ' } { $ORD43 }</column>\n<column name='cORD44'>{ $rs/ANLA/ROW/ORD44/text() } { ' ' } { $ORD44 }</column>\n<column name='cIZWEK'>{ $rs/ANLA/ROW/IZWEK/text() } { ' ' } { $IZWEK }</column>\n<column name='cUMWKZ'>{ $rs/ANLA/ROW/UMWKZ/text() } { ' ' } { $UMWKZ }</column>\n<column name='cANLUE'>{ $rs/ANLA/ROW/ANLUE/text() } { ' ' } { $ANLUE }</column>\n\n<column name='cLIFNR'>{ $LIFNR } { $rs/LFA1/ROW/NAME1/text() }</column>\n<column name='cHERST'>{ $rs/ANLA/ROW/HERST/text() }</column>\n<column name='cVBUND'>{ $rs/ANLA/ROW/VBUND/text() } { ' ' } { $VBUND }</column>\n<column name='cLAND1'>{ $rs/ANLA/ROW/LAND1/text() } { ' ' } { $LAND1 }</column>\n<column name='cTYPBZ'>{ $rs/ANLA/ROW/TYPBZ/text() }</column>\n<column name='cAIBN1'>{ $rs/ANLA/ROW/AIBN1/text() } { ' ' } { $rs/ANLA/ROW/AIBN2/text() }</column>\n<column name='cAIBDT'>{ $rs/ANLA/ROW/AIBDT/text() }</column>\n<column name='cURJHR'>{ $rs/ANLA/ROW/URJHR/text() }</column>\n<column name='cURWRT'>{ $rs/ANLA/ROW/URWRT/text() } { $WAERS }</column>\n<column name='cANTEI'>{ $rs/ANLA/ROW/ANTEI/text() }</column>\n\n<column name='cVMGLI'>{ $rs/ANLA/ROW/VMGLI/text() } { ' ' } { $VMGLI }</column>\n<column name='cEIGKZ'>{ $rs/ANLA/ROW/EIGKZ/text() } { ' ' } { $EIGKZ }</column>\n<column name='cGRUND'>{ $rs/ANLA/ROW/GRUND/text() } { ' ' } { $GRUND }</column>\n<column name='cWRTMA'>{ $rs/ANLA/ROW/WRTMA/text() } { ' ' } { $WAERS }</column>\n<column name='cFIAMT'>{ $rs/ANLA/ROW/FIAMT/text() }</column>\n<column name='cEHWNR'>{ $rs/ANLA/ROW/EHWNR/text() }</column>\n<column name='cEHWZU'>{ $rs/ANLA/ROW/EHWZU/text() }</column>\n<column name='cSTADT'>{ $rs/ANLA/ROW/STADT/text() }</column>\n<column name='cGRUVO'>{ $rs/ANLA/ROW/GRUVO/text() }</column>\n<column name='cGREIN'>{ $rs/ANLA/ROW/GREIN/text() }</column>\n<column name='cGRBND'>{ $rs/ANLA/ROW/GRBND/text() } { ' ' } { $rs/ANLA/ROW/GRBLT/text() } { ' ' } { $rs/ANLA/ROW/GRLFD/text() }</column>\n<column name='cAUFLA'>{ $rs/ANLA/ROW/AUFLA/text() }</column>\n<column name='cFLURK'>{ $rs/ANLA/ROW/FLURK/text() }</column>\n<column name='cFLURN'>{ $rs/ANLA/ROW/FLURN/text() }</column>\n<column name='cGRUFL'>{ $rs/ANLA/ROW/GRUFL/text() } { ' ' } { $rs/ANLA/ROW/FEINS/text() }</column>\n\n<column name='cVSART'>{ $rs/ANLV/ROW/VSART/text() } { ' ' } { $VSART }</column>\n<column name='cVSGES'>{ $rs/ANLV/ROW/VSGES/text() } { ' ' } { $VSGES }</column>\n<column name='cVSSTX'>{ $rs/ANLV/ROW/VSSTX/text() }</column>\n<column name='cVSZTX'>{ $rs/ANLV/ROW/VSZTX/text() }</column>\n<column name='cVRSBG'>{ $rs/ANLA/ROW/VRSBG/text() }</column>\n<column name='cVSTAR'>{ $rs/ANLV/ROW/VSTAR/text() } { ' ' } { $VSTAR }</column>\n<column name='cVSIND'>{ $rs/ANLV/ROW/VSIND/text() } { ' ' } { $VSIND }</column>\n<column name='cVRSBA'>{ $rs/ANLV/ROW/VRSBA/text() } { ' ' } { $VRSBA }</column>\n<column name='cVSMAN'>{ $rs/ANLV/ROW/VSMAN/text() }</column>\n<column name='cVRSMA'>{ $rs/ANLV/ROW/VRSMA/text() } { ' ' } { $VRSBA }</column>\n<column name='cVRSJH'>{ $rs/ANLV/ROW/VRSJH/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)\n",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "AS03 - Display Asset",
  "compositionName" : "AS03"
}