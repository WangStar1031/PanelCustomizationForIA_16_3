{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "6906798b-eef7-4eef-a4b7-8a1c8a63c3e4",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sBANFN external;\n\ndeclare function local:get_esttx($value) {\n  switch ($value)\n    case \"R\" return \"Created Manually\"\n    case \"B\" return \"from MRP\"\n    case \"V\" return \"from Sales Document\"\n    case \"U\" return \"from Planned Order\"\n    case \"F\" return \"from Prodn Order\"\n    case \"D\" return \"Direct Procurement\"\n    case \"A\" return \"SAP APO\"\n    default return \"\"\n};\n\ndeclare function local:get_statx($value) {\n  switch ($value)\n    case \"N\" return \"Not Processed\"\n    case \"A\" return \"RFQ Issued\"\n    case \"B\" return \"Ordered\"\n    case \"K\" return \"Contract Created\"\n    case \"L\" return \"Schediling Agreement Created\"\n    case \"S\" return \"Service Entry Sheet Created\"\n    default return \"\"\n};\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sBANFN, concat(\"contains($eban/BANFN, &apos;\", $sBANFN, \"&apos;)\" ))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n \n(: Search the data within the Table with a join on Info Record [BANFN] :) \n(: Select * from EBAN :)\n\nlet $query-str := concat(\"for $eban in /SAP/EBAN/ROW[contains('B',BSTYP)] \", $whereClause, \"  return <RS><EBAN>{ $eban }</EBAN></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows := \n\tfor $rs in $main-query \n    \n    let $EEIND := sias:showdate($rs/EBAN/ROW/EEIND/text())\n    let $MEINS := sias:get_t006a($rs/EBAN/ROW/MEINS/text())\n    let $FRGKZ_name := sias:get_t161u($rs/EBAN/ROW/FRGKZ/text())\n    let $BADAT := sias:showdate($rs/EBAN/ROW/BADAT/text())\n    let $BEDAT := sias:showdate($rs/EBAN/ROW/BEDAT/text())\n    let $FRGDT := sias:showdate($rs/EBAN/ROW/FRGDT/text())\n    let $GSWRT := sias:currency($rs/EBAN/ROW/GSWRT/text(), \"\")\n    let $ESTKZ_name := local:get_esttx($rs/EBAN/ROW/ESTKZ/text())\n    let $STATU_name := local:get_statx($rs/EBAN/ROW/STATU/text())\n    \nreturn\n<row id='{string($rs/EBAN/ROW/@table:id)}'>\n<column name='cBANFN'>{ $rs/EBAN/ROW/BANFN/text() }</column>\n<column name='cBNFPO'>{ $rs/EBAN/ROW/BNFPO/text() }</column>\n<column name='cPurchReq'>{ $rs/EBAN/ROW/BANFN/text() } { '  ' } { $rs/EBAN/ROW/BNFPO/text() }</column>\n<column name='cBSART'>{ $rs/EBAN/ROW/BSART/text() }</column>\n<column name='cPSTYP'>{ $rs/EBAN/ROW/PSTYP/text() }</column>\n<column name='cKNTTP'>{ $rs/EBAN/ROW/KNTTP/text() }</column>\n<column name='cMATNR'>{ $rs/EBAN/ROW/MATNR/text() }</column>\n<column name='cTXZ01'>{ $rs/EBAN/ROW/TXZ01/text() }</column>\n<column name='cMENGE'>{ $rs/EBAN/ROW/MENGE/text() }</column>\n<column name='cMEINS'>{ $MEINS }</column>\n<column name='cQuantity'>{ $rs/EBAN/ROW/MENGE/text() } { '  ' } { $MEINS }</column>\n<column name='cLPEIN'>{ $rs/EBAN/ROW/LPEIN/text() }</column>\n<column name='cEEIND'>{ $EEIND }</column>\n<column name='cDelivery'>{ $rs/EBAN/ROW/LPEIN/text() } { '  ' } { $EEIND }</column>\n<column name='cEKGRP'>{ $rs/EBAN/ROW/EKGRP/text() }</column>\n<column name='cMATKL'>{ $rs/EBAN/ROW/MATKL/text() }</column>\n<column name='cWERKS'>{ $rs/EBAN/ROW/WERKS/text() }</column>\n<column name='cLGORT'>{ $rs/EBAN/ROW/LGORT/text() }</column>\n<column name='cRESWK'>{ $rs/EBAN/ROW/RESWK/text() }</column>\n<column name='cAFNAM'>{ $rs/EBAN/ROW/AFNAM/text() }</column>\n<column name='cBEDNR'>{ $rs/EBAN/ROW/BEDNR/text() }</column>\n<column name='cDISPO'>{ $rs/EBAN/ROW/DISPO/text() }</column>\n<column name='cREVLV'>{ $rs/EBAN/ROW/REVLV/text() }</column>\n<column name='cFIXKZ'>{ $rs/EBAN/ROW/FIXKZ/text() }</column>\n<column name='cBADAT'>{ $BADAT }</column>\n<column name='cBATOL'>{ $rs/EBAN/ROW/BATOL/text() }</column>\n<column name='cFRGDT'>{ $FRGDT }</column>\n<column name='cWEBAZ'>{ $rs/EBAN/ROW/WEBAZ/text() } Days</column>\n<column name='cEBAKZ'>{ $rs/EBAN/ROW/EBAKZ/text() }</column>\n<column name='cPREIS'>{ $rs/EBAN/ROW/PREIS/text() }</column>\n<column name='cWAERS'>{ $rs/EBAN/ROW/WAERS/text() }</column>\n<column name='cPEINH'>{ $rs/EBAN/ROW/PEINH/text() }</column>\n<column name='cValPrice'>{ $rs/EBAN/ROW/PREIS/text() } { '  ' } { $rs/EBAN/ROW/WAERS/text() } / { $rs/EBAN/ROW/PEINH/text() } { '  ' } { $MEINS }</column>\n<column name='cWEPOS'>{ $rs/EBAN/ROW/WEPOS/text() }</column>\n<column name='cREPOS'>{ $rs/EBAN/ROW/REPOS/text() }</column>\n<column name='cWEUNB'>{ $rs/EBAN/ROW/WEUNB/text() }</column>\n<column name='cKONNR'>{ $rs/EBAN/ROW/KONNR/text() }</column>\n<column name='cKTPNR'>{ $rs/EBAN/ROW/KTPNR/text() }</column>\n<column name='cAgreement'>{ $rs/EBAN/ROW/KONNR/text() } { '  ' } { $rs/EBAN/ROW/KTPNR/text() }</column>\n<column name='cEKORG'>{ $rs/EBAN/ROW/EKORG/text() }</column>\n<column name='cFLIEF'>{ $rs/EBAN/ROW/FLIEF/text() }</column>\n<column name='cINFNR'>{ $rs/EBAN/ROW/INFNR/text() }</column>\n<column name='cLIFNR'>{ $rs/EBAN/ROW/LIFNR/text() }</column>\n<column name='cBMEIN'>{ $rs/EBAN/ROW/BMEIN/text() }</column>\n<column name='cIDNLF'>{ $rs/EBAN/ROW/IDNLF/text() }</column>\n<column name='cAKTNR'>{ $rs/EBAN/ROW/AKTNR/text() }</column>\n<column name='cCHARG'>{ $rs/EBAN/ROW/CHARG/text() }</column>\n<column name='cESTKZ'>{ $rs/EBAN/ROW/ESTKZ/text() }</column>\n<column name='cESTKZ_name'>{ $rs/EBAN/ROW/ESTKZ/text() } { ' ' } { $ESTKZ_name }</column>\n<column name='cSTATU'>{ $rs/EBAN/ROW/STATU/text() }</column>\n<column name='cSTATU_name'>{ $rs/EBAN/ROW/STATU/text() } { ' ' } { $STATU_name }</column>\n<column name='cERNAM'>{ $rs/EBAN/ROW/ERNAM/text() }</column>\n<column name='cERDAT'>{ $rs/EBAN/ROW/ERDAT/text() }</column>\n<column name='cFRGKZ'>{ $rs/EBAN/ROW/FRGKZ/text() }</column>\n<column name='cFRGKZ_name'>{ $rs/EBAN/ROW/FRGKZ/text() } { ' ' } { $FRGKZ_name }</column>\n<column name='cFRGST'>{ $rs/EBAN/ROW/FRGST/text() }</column>\n<column name='cBVDRK'>{ $rs/EBAN/ROW/BVDRK/text() }</column>\n<column name='cBVDAT'>{ $rs/EBAN/ROW/BVDAT/text() }</column>\n<column name='cGSWRT'>{ $rs/EBAN/ROW/GSWRT/text() }</column>\n<column name='cTotalVal'>{ $GSWRT } { ' ' } { $rs/EBAN/ROW/WAERS/text() }</column>\n<column name='cBSMNG'>{ $rs/EBAN/ROW/BSMNG/text() }</column>\n<column name='cPOQuantity'>{ $rs/EBAN/ROW/BSMNG/text() } { ' ' } { $MEINS }</column>\n<column name='cEBELN'>{ $rs/EBAN/ROW/EBELN/text() }</column>\n<column name='cEBELP'>{ $rs/EBAN/ROW/EBELP/text() }</column>\n<column name='cPO'>{ $rs/EBAN/ROW/EBELN/text() } { ' ' } { $rs/EBAN/ROW/EBELP/text() }</column>\n<column name='cBEDAT'>{ $BEDAT }</column>\n<column name='cBUMNG'>{ $rs/EBAN/ROW/BUMNG/text() }</column>\n<column name='cShortage'>{ $rs/EBAN/ROW/BUMNG/text() } { ' ' } { $MEINS }</column>\n<column name='cPLIFZ'>{ $rs/EBAN/ROW/PLIFZ/text() } Days</column>\n<column name='cRSNUM'>{ $rs/EBAN/ROW/RSNUM/text() }</column>\n<column name='cARSNR'>{ $rs/EBAN/ROW/ARSNR/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "ME53 - Display Purchase Requisition",
  "compositionName" : "ME53"
}