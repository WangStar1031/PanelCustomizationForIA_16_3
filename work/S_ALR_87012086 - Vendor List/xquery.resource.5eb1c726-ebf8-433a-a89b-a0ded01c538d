{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "6fd385bc-4588-41b1-889f-6e849270e246",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\ndeclare variable $page external := 0;\ndeclare variable $size external := 10;\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sLIFNR external;\ndeclare variable $sBUKRS external;\n\n\ndeclare function local:getResultsPage($rows, $page, $size)\n{\n\tlet $offset := $page * $size\n  \tlet $total := count($rows)\n  \treturn <results total=\"{ $total }\"> { for $row in subsequence($rows, $offset + 1, $size) return $row }</results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\n\tif (empty($var) or $var = \"\")\n\tthen $whereClause\n\telse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\ndeclare function local:getADRC($adrnr)\n{\n for $adrc in /SAP/ADRC/ROW[ADDRNUMBER = $adrnr]\n return <RS><ADRC>{$adrc}</ADRC></RS>\n\n};\ndeclare function local:getLFBK($lifnr)\n{\n for $lfbk in /SAP/LFBK/ROW[LIFNR = $lifnr]\n return <RS><LFBK>{$lfbk}</LFBK></RS>\n};\ndeclare function local:getBNKA($banks,$bankl)\n{\n for $bnka in /SAP/BNKA/ROW[BANKS = $banks and BANKL = $bankl]\n return <RS><BNKA>{$bnka}</BNKA></RS>\n};\ndeclare function local:getTIBAN($banks,$bankl,$bankn,$bkont)\n{\n for $tiban in /SAP/TIBAN/ROW[BANKS = $banks and BANKL = $bankl and BANKN = $bankn and BKONT = $bkont]\n return <RS><TIBAN>{$tiban}</TIBAN></RS>\n};\n\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sLIFNR, concat(\"contains($lfb1/LIFNR, &apos;\", $sLIFNR, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sBUKRS, concat(\"$lfb1/BUKRS = &apos;\", $sBUKRS, \"&apos;\"))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $lfb1 in /SAP/LFB1/ROW, $lfa1 in /SAP/LFA1/ROW[LIFNR = $lfb1/LIFNR] \", $whereClause, \" return <RS><LFB1>{ $lfb1 }</LFB1><LFA1>{ $lfa1 }</LFA1></RS>\")\nlet $main-query := xhive:evaluate($query-str)\nlet $rows := \n\tfor $rs in $main-query\n    \n    let $ADRC  := local:getADRC($rs/LFA1/ROW/ADRNR/text())\n    let $LFBK  := local:getLFBK($rs/LFA1/ROW/LIFNR/text())\n    let $BNKA  := local:getBNKA($LFBK/LFBK/ROW/BANKS/text(),$LFBK/LFBK/ROW/BANKL/text())\n    let $TIBAN := local:getTIBAN($LFBK/LFBK/ROW/BANKS/text(),$LFBK/LFBK/ROW/BANKL/text(),$LFBK/LFBK/ROW/BANKN/text(),$LFBK/LFBK/ROW/BKONT/text())\n    let $BUTXT := sias:get_t001($rs/LFB1/ROW/BUKRS/text(),\"BUTXT\")\n    return\n\n<row id='{string($rs/BKPF/ROW/@table:id)}'>\n<column name='cSORTL'>{ $rs/LFA1/ROW/SORTL/text() }</column>\n<column name='cKTOKK'>{ $rs/LFA1/ROW/KTOKK/text() }</column>\n<column name='cERNAM'>{ $rs/LFA1/ROW/ERNAM/text() }</column>\n<column name='cERDAT'>{ $rs/LFA1/ROW/ERDAT/text() }</column>\n<column name='cLIFNR'>{ $rs/LFA1/ROW/LIFNR/text() }</column>\n<column name='cBUKRS'>{ $rs/LFB1/ROW/BUKRS/text() }</column>\n<column name='cBUTXT2'>{ $BUTXT }</column>\n\n<column name='cANRED'>{ $rs/LFA1/ROW/ANRED/text() }</column>\n<column name='cSPRAS'>{ $rs/LFA1/ROW/SPRAS/text() }</column>\n<column name='cTELF1'>{ $rs/LFA1/ROW/TELF1/text() }</column>\n<column name='cNAME1'>{ $rs/LFA1/ROW/NAME1/text() }</column>\n<column name='cLAND1'>{ $rs/LFA1/ROW/LAND1/text() }</column>\n<column name='cTELF2'>{ $rs/LFA1/ROW/TELF2/text() }</column>\n<column name='cNAME2'>{ $rs/LFA1/ROW/NAME2/text() }</column>\n<column name='cREGIO'>{ $rs/LFA1/ROW/REGIO/text() }</column>\n<column name='cTELFX'>{ $rs/LFA1/ROW/TELFX/text() }</column>\n<column name='cNAME3'>{ $rs/LFA1/ROW/NAME3/text() }</column>\n<column name='cTELX1'>{ $rs/LFA1/ROW/TELX1/text() }</column>\n<column name='cNAME4'>{ $rs/LFA1/ROW/NAME4/text() }</column>\n<column name='cTIME_ZONE'>{ $ADRC/ADRC/ROW/TIME_ZONE/text() }</column>\n<column name='cTELTX'>{ $rs/LFA1/ROW/TELTX/text() }</column>\n<column name='cDEFLT_COMM'>{ $ADRC/ADRC/ROW/DEFLT_COMM/text() }</column>\n<column name='cTELBX'>{ $rs/LFA1/ROW/TELBX/text() }</column>\n<column name='cDATLT'>{ $rs/LFA1/ROW/DATLT/text() }</column>\n<column name='cORT01'>{ $rs/LFA1/ROW/ORT01/text() }</column>\n<column name='cPSTLZ'>{ $rs/LFA1/ROW/PSTLZ/text() }</column>\n<column name='cPFACH'>{ $rs/LFA1/ROW/PFACH/text() }</column>\n<column name='cORT02'>{ $rs/LFA1/ROW/ORT02/text() }</column>\n<column name='cSTRAS'>{ $rs/LFA1/ROW/STRAS/text() }</column>\n\n<column name='cSPERR'>{ $rs/LFA1/ROW/SPERR/text() }</column>\n<column name='cLOEVM'>{ $rs/LFA1/ROW/LOEVM/text() }</column>\n<column name='cBEGRU'>{ $rs/LFA1/ROW/BEGRU/text() }</column>\n<column name='cXCPDK'>{ $rs/LFA1/ROW/XCPDK/text() }</column>\n<column name='cKUNNR'>{ $rs/LFA1/ROW/KUNNR/text() }</column>\n<column name='cVBUND'>{ $rs/LFA1/ROW/VBUND/text() }</column>\n<column name='cKONZS'>{ $rs/LFA1/ROW/KONZS/text() }</column>\n\n<column name='cSTCD1'>{ $rs/LFA1/ROW/STCD1/text() }</column>\n<column name='cFISKN'>{ $rs/LFA1/ROW/FISKN/text() }</column>\n<column name='cSTKZU'>{ $rs/LFA1/ROW/STKZU/text() }</column>\n<column name='cSTKZA'>{ $rs/LFA1/ROW/STKZA/text() }</column>\n<column name='cSTCD2'>{ $rs/LFA1/ROW/STCD2/text() }</column>\n<column name='cSTKZN'>{ $rs/LFA1/ROW/STKZN/text() }</column>\n<column name='cSTCEG'>{ $rs/LFA1/ROW/STCEG/text() }</column>\n<column name='cFISKU'>{ $rs/LFA1/ROW/FISKU/text() }</column>\n<column name='cSTENR'>{ $rs/LFA1/ROW/STENR/text() }</column>\n<column name='cBBBNR'>{ $rs/LFA1/ROW/BBBNR/text() }</column>\n<column name='cBBSNR'>{ $rs/LFA1/ROW/BBSNR/text() }</column>\n<column name='cBUBKZ'>{ $rs/LFA1/ROW/BUBKZ/text() }</column>\n<column name='cBRSCH'>{ $rs/LFA1/ROW/BRSCH/text() }</column>\n<column name='cKRAUS'>{ $rs/LFA1/ROW/KRAUS/text() }</column>\n<column name='cREVDB'>{ $rs/LFA1/ROW/REVDB/text() }</column>\n<column name='cQSSYS'>{ $rs/LFA1/ROW/QSSYS/text() }</column>\n<column name='cTXJCD'>{ $rs/LFA1/ROW/TXJCD/text() }</column>\n<column name='cJ_1KFREPRE'>{ $rs/LFA1/ROW/J_1KFREPRE/text() }</column>\n<column name='cJ_1KFTIND'>{ $rs/LFA1/ROW/J_1KFTIND/text() }</column>\n<column name='cJ_1KFTIND2'>{ $rs/LFA1/ROW/J_1KFTIND/text() }</column>\n\n<column name='cBANKA'>{ $BNKA/BNKA/ROW/BANKA/text() }</column>\n<column name='cBANKL'>{ $LFBK/LFBK/ROW/BANKL/text() }</column>\n<column name='cBANKS'>{ $LFBK/LFBK/ROW/BANKS/text() }</column>\n<column name='cBANKN'>{ $LFBK/LFBK/ROW/BANKN/text() }</column>\n<column name='cBKONT'>{ $LFBK/LFBK/ROW/BKONT/text() }</column>\n<column name='cXEZER'>{ $LFBK/LFBK/ROW/XEZER/text() }</column>\n<column name='cBVTYP'>{ $LFBK/LFBK/ROW/BVTYP/text() }</column>\n<column name='cSWIFT'>{ $BNKA/BNKA/ROW/SWIFT/text() }</column>\n<column name='cXPGRO'>{ $BNKA/BNKA/ROW/XPGRO/text() }</column>\n<column name='cBKREF'>{ $LFBK/LFBK/ROW/BKREF/text() }</column>\n<column name='cKOINH'>{ $LFBK/LFBK/ROW/KOINH/text() }</column>\n<column name='cBRNCH'>{ $BNKA/BNKA/ROW/BRNCH/text() }</column>\n<column name='cIBAN'>{ $TIBAN/TIBAN/ROW/IBAN/text() }</column>\n<column name='cVALID_FROM'>{ $TIBAN/TIBAN/ROW/VALID_FROM/text() }</column>\n\n\n<column name='cSPERR2'>{ $rs/LFB1/ROW/SPERR/text() }</column>\n<column name='cLOEVM2'>{ $rs/LFB1/ROW/LOEVM/text() }</column>\n<column name='cBEGRU2'>{ $rs/LFB1/ROW/BEGRU/text() }</column>\n<column name='cFDGRV'>{ $rs/LFB1/ROW/FDGRV/text() }</column>\n<column name='cMINDK'>{ $rs/LFB1/ROW/MINDK/text() }</column>\n<column name='cZUAWA'>{ $rs/LFB1/ROW/ZUAWA/text() }</column>\n<column name='cAKONT'>{ $rs/LFB1/ROW/AKONT/text() }</column>\n<column name='cKNRZE'>{ $rs/LFB1/ROW/KNRZE/text() }</column>\n<column name='cBLNKZ'>{ $rs/LFB1/ROW/BLNKZ/text() }</column>\n<column name='cFRGRP'>{ $rs/LFB1/ROW/FRGRP/text() }</column>\n\n<column name='cVZSKZ'>{ $rs/LFB1/ROW/VZSKZ/text() }</column>\n<column name='cZINDT'>{ $rs/LFB1/ROW/ZINDT/text() }</column>\n<column name='cDATLZ'>{ $rs/LFB1/ROW/DATLZ/text() }</column>\n<column name='cZINRT'>{ $rs/LFB1/ROW/ZINRT/text() }</column>\n\n<column name='cQSSKZ'>{ $rs/LFB1/ROW/QSSKZ/text() }</column>\n<column name='cQSZNR'>{ $rs/LFB1/ROW/QSZNR/text() }</column>\n<column name='cQSZDT'>{ $rs/LFB1/ROW/QSZDT/text() }</column>\n<column name='cQSREC'>{ $rs/LFB1/ROW/QSREC/text() }</column>\n<column name='cQSBGR'>{ $rs/LFB1/ROW/QSBGR/text() }</column>\n<column name='cQLAND'>{ $rs/LFB1/ROW/QLAND/text() }</column>\n\n<column name='cZTERM'>{ $rs/LFB1/ROW/ZTERM/text() }</column>\n<column name='cTOGRU'>{ $rs/LFB1/ROW/TOGRU/text() }</column>\n<column name='cKULTG'>{ $rs/LFB1/ROW/KULTG/text() }</column>\n<column name='cBUTXT'>{ $rs/LFB1/ROW/BUTXT/text() }</column>\n<column name='cXPORE'>{ $rs/LFB1/ROW/XPORE/text() }</column>\n<column name='cREPRF'>{ $rs/LFB1/ROW/REPRF/text() }</column>\n<column name='cZWELS'>{ $rs/LFB1/ROW/ZWELS/text() }</column>\n<column name='cUZAWE'>{ $rs/LFB1/ROW/UZAWE/text() }</column>\n<column name='cXVERR'>{ $rs/LFB1/ROW/XVERR/text() }</column>\n<column name='cWEBTR'>{ $rs/LFB1/ROW/WEBTR/text() }</column>\n<column name='cZAHLS'>{ $rs/LFB1/ROW/ZAHLS/text() }</column>\n<column name='cLNRZB'>{ $rs/LFB1/ROW/LNRZB/text() }</column>\n<column name='cHBKID'>{ $rs/LFB1/ROW/HBKID/text() }</column>\n<column name='cZGRUP'>{ $rs/LFB1/ROW/ZGRUP/text() }</column>\n<column name='cXEDIP'>{ $rs/LFB1/ROW/XEDIP/text() }</column>\n<column name='cPREPAY_RELEVANT'>{ $rs/LFB1/ROW/PREPAY_RELEVANT/text() }</column>\n\n<column name='cZSABE'>{ $rs/LFB1/ROW/ZSABE/text() }</column>\n<column name='cBUSAB'>{ $rs/LFB1/ROW/BUSAB/text() }</column>\n<column name='cEIKTO'>{ $rs/LFB1/ROW/EIKTO/text() }</column>\n<column name='cXDEZV'>{ $rs/LFB1/ROW/XDEZV/text() }</column>\n<column name='cKVERM'>{ $rs/LFB1/ROW/KVERM/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "S_ALR_87012086 - Vendor List",
  "compositionName" : "Set 1"
}