{
  "createdBy" : "sue@iacustomer.com",
  "createdDate" : null,
  "lastModifiedBy" : "sue@iacustomer.com",
  "lastModifiedDate" : null,
  "name" : "3dac4abb-3e08-4e32-905d-696fe205e80b",
  "query" : "import module namespace sias=\"urn:x-sig:sias:util:fn\";\n\ndeclare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\n\ndeclare variable $page external;\ndeclare variable $size external;\n\ndeclare variable $sVBELN external;\n\ndeclare function local:getResultsPage($rows, $page, $size) \n{\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\ndeclare function local:get_kna1($kunnr)\n{\n   for $kna1 in /SAP/KNA1/ROW[KUNNR=$kunnr]\n   return $kna1/NAME1/text()\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n\nlet $whereClause := local:addClause(\"\", $sVBELN, concat(\"contains($likp/VBELN, &apos;\", $sVBELN, \"&apos;)\" ))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause  \n   \n\nlet $query-str := concat(\"for $likp in /SAP/LIKP/ROW,$lips in /SAP/LIPS/ROW[VBELN = $likp/VBELN],$vbpa in/SAP/VBPA/ROW[VBELN = $lips/VBELN] \", $whereClause, \" return <RS><LIKP>{ $likp }</LIKP><LIPS>{ $lips }</LIPS><VBPA>{ $vbpa }</VBPA></RS>\") \n \nlet $main-query := xhive:evaluate($query-str)\n\nlet $rows :=  \n               for $rs in $main-query  \n  \t\t let $TPART := sias:get_tpart($rs/VBPA/ROW/PARVW/text())\n   \t\t let $KNA1 := local:get_kna1($rs/LIKP/ROW/KUNNR/text())\n         let $VBELN := sias:trimzero($rs/LIKP/ROW/VBELN/text())\n         let $KUNNR := sias:trimzero($rs/LIKP/ROW/KUNNR/text())\n    \nreturn\n<row id='{string($rs/LIKP/ROW/@table:id)}'>\n<column name='cVBELN'>{ $VBELN }</column>\n<column name='cPARVW'>{ $rs/VBPA/ROW/PARVW/text() } { ' ' } { $TPART }</column>\n<column name='cKUNNR'>{ $KUNNR }</column>\n<column name='cNAME1'>{ $KNA1 }</column>\n<column name='cKNREF'>{ $rs/VBPA/ROW/KNREF/text() }</column>\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)\n",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "VL03 - Partner",
  "compositionName" : "VF03 - Head.prtnrs"
}