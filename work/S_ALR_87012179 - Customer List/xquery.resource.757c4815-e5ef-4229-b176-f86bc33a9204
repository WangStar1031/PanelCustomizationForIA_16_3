{
  "createdBy" : "admin@sigma-sbs.com",
  "createdDate" : null,
  "lastModifiedBy" : "admin@sigma-sbs.com",
  "lastModifiedDate" : null,
  "name" : "281666a4-8a56-4e43-bed6-607e53e1043a",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\ndeclare variable $page external := 0;\ndeclare variable $size external := 10;\n\n(: Our External Search variable matching the SAP Fieldname :)\ndeclare variable $sKUNNR external;\ndeclare variable $sKUNNR2 external;\ndeclare variable $sBUKRS external;\n\ndeclare function local:getResultsPage($rows, $page, $size)\n{\n\tlet $offset := $page * $size\n  \tlet $total := count($rows)\n  \treturn <results total=\"{ $total }\"> { for $row in subsequence($rows, $offset + 1, $size) return $row }</results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\n\tif (empty($var) or $var = \"\")\n\tthen $whereClause\n\telse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\ndeclare function local:getTIBAN($BANKS, $BANKL, $BANKN, $BKONT)\n{\n\tfor $tiban in /SAP/TIBAN/ROW\n    where $tiban/BANKS = $BANKS and $tiban/BANKL = $BANKL and $tiban/BANKN = $BANKN and $tiban/BKONT =$BKONT\n    return <RS><TIBAN>{$tiban}</TIBAN></RS>\n};\ndeclare function local:getBNKA($BANKS, $BANKL)\n{\n\tfor $bnka in /SAP/BNKA/ROW\n    where $bnka/BANKS = $BANKS and $bnka/BANKL = $BANKL\n    return <RS><BNKA>{$bnka}</BNKA></RS>\n};\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sBUKRS, concat(\"contains($knb1/BUKRS, &apos;\", $sBUKRS, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sKUNNR, concat(\"$knb1/KUNNR >= &apos;\", $sKUNNR, \"&apos;\"))\nlet $whereClause := local:addClause($whereClause, $sKUNNR2, concat(\"$knb1/KUNNR <= &apos;\", $sKUNNR2, \"&apos;\"))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $knb1 in /SAP/KNB1/ROW, $kna1 in /SAP/KNA1/ROW[KUNNR = $knb1/KUNNR], $adrc in /SAP/ADRC/ROW[ADDRNUMBER = $kna1/ADRNR], $knbk in /SAP/KNBK/ROW[KUNNR = $kna1/KUNNR],   $knka in /SAP/KNKA/ROW[KUNNR = $kna1/KUNNR], $knkk in /SAP/KNKK/ROW[KUNNR = $kna1/KUNNR ], $knb5 in /SAP/KNB5/ROW[KUNNR = $knb1/KUNNR and BUKRS = $knb1/BUKRS]\", $whereClause, \" return <RS><KNB1>{ $knb1 }</KNB1><KNA1>{ $kna1 }</KNA1><ADRC>{ $adrc }</ADRC><KNBK>{ $knbk }</KNBK><KNKA>{ $knka }</KNKA><KNKK>{ $knkk }</KNKK><KNB5>{ $knb5 }</KNB5></RS>\")\nlet $main-query := xhive:evaluate($query-str)\nlet $rows := \n\tfor $rs in $main-query\n   let $BUTXT := sias:get_t001($rs/KNB1/ROW/BUKRS/text(), \"BUTXT\")\n   let $TIBAN := local:getTIBAN($rs/KNBK/ROW/BANKS/text(),$rs/KNBK/ROW/BANKL/text(),$rs/KNBK/ROW/BANKN/text(),$rs/KNBK/ROW/BKONT/text())\n   let $BNKA := local:getBNKA($rs/KNBK/ROW/BANKS/text(),$rs/KNBK/ROW/BANKL/text())\n    return\n\n<row id='{string($rs/BKPF/ROW/@table:id)}'>\n<column name='cKUNNR'>{ $rs/KNA1/ROW/KUNNR/text() }</column>\n<column name='cBUKRS'>{ $rs/KNB1/ROW/BUKRS/text() }</column>\n<column name='cBUTXT'>{ $BUTXT }</column>\n<column name='cSORTL'>{$rs/KNA1/ROW/SORTL/text()}</column>\n<column name='cKTOKD'>{ $rs/KNA1/ROW/KTOKD/text() }</column>\n<column name='cERNAM'>{ $rs/KNA1/ROW/ERNAM/text() }</column>\n<column name='cERDAT'>{ $rs/KNA1/ROW/ERDAT/text() }</column>\n\n<column name='cANRED'>{ $rs/KNA1/ROW/ANRED/text() }</column>\n<column name='cSPRAS'>{ $rs/KNA1/ROW/SPRAS/text() }</column>\n<column name='cTELF1'>{ $rs/KNA1/ROW/TELF1/text() }</column>\n<column name='cNAME1'>{ $rs/KNA1/ROW/NAME1/text() }</column>\n<column name='cLAND1'>{ $rs/KNA1/ROW/LAND1/text() }</column>\n<column name='cTELF2'>{ $rs/KNA1/ROW/TELF2/text() }</column>\n<column name='cNAME2'>{ $rs/KNA1/ROW/NAME2/text() }</column>\n<column name='cREGIO'>{ $rs/KNA1/ROW/REGIO/text() }</column>\n<column name='cTELFX'>{ $rs/KNA1/ROW/TELFX/text() }</column>\n<column name='cNAME3'>{ $rs/KNA1/ROW/NAME3/text() }</column>\n<column name='cTELX1'>{ $rs/KNA1/ROW/TELX1/text() }</column>\n<column name='cNAME4'>{ $rs/KNA1/ROW/NAME4/text() }</column>\n<column name='cTIME_ZONE'>{ $rs/ADRC/ROW/TIME_ZONE/text() }</column>\n<column name='cTELTX'>{ $rs/KNA1/ROW/TELTX/text() }</column>\n<column name='cDEFLT_COMM'>{ $rs/ADRC/ROW/DEFLT_COMM/text() }</column>\n<column name='cTELBX'>{ $rs/KNA1/ROW/TELBX/text() }</column>\n<column name='cDATLT'>{ $rs/KNA1/ROW/DATLT/text() }</column>\n<column name='cORT01'>{ $rs/KNA1/ROW/ORT01/text() }</column>\n<column name='cPSTLZ'>{ $rs/KNA1/ROW/PSTLZ/text() }</column>\n<column name='cPFACH'>{ $rs/KNA1/ROW/PFACH/text() }</column>\n<column name='cORT02'>{ $rs/KNA1/ROW/ORT02/text() }</column>\n<column name='cSTRAS'>{ $rs/KNA1/ROW/STRAS/text() }</column>\n\n<column name='cSPERR'>{ $rs/KNA1/ROW/SPERR/text()  }</column>\n<column name='cLOEVM'>{ $rs/KNA1/ROW/LOEVM/text()  }</column>\n<column name='cBEGRU'>{ $rs/KNA1/ROW/BEGRU/text()  }</column>\n<column name='cXCPDK'>{ $rs/KNA1/ROW/XCPDK/text()  }</column>\n<column name='cLIFNR'>{ $rs/KNA1/ROW/LIFNR/text()  }</column>\n<column name='cVBUND'>{ $rs/KNA1/ROW/VBUND/text()  }</column>\n<column name='cKONZS'>{ $rs/KNA1/ROW/KONZS/text()  }</column>\n\n<column name='cSTCD1'>{ $rs/KNA1/ROW/STCD1/text()  }</column>\n<column name='cFISKN'>{ $rs/KNA1/ROW/FISKN/text()  }</column>\n<column name='cSTKZU'>{ $rs/KNA1/ROW/STKZU/text()  }</column>\n<column name='cSTKZA'>{ $rs/KNA1/ROW/STKZA/text()  }</column>\n<column name='cSTCD2'>{$rs/KNA1/ROW/STCD2/text()  }</column>\n<column name='cCOUNC'>{ $rs/KNA1/ROW/COUNC/text()  }</column>\n<column name='cCITYC'>{ $rs/KNA1/ROW/CITYC/text()  }</column>\n<column name='cTXJCD'>{ $rs/KNA1/ROW/TXJCD/text() }</column>\n<column name='cSTKZN'>{ $rs/KNA1/ROW/STKZN/text() }</column>\n<column name='cSTCEG'>{ $rs/KNA1/ROW/STCEG/text() }</column>\n<column name='cBBBNR'>{ $rs/KNA1/ROW/BBBNR/text() }</column>\n<column name='cBBSNR'>{ $rs/KNA1/ROW/BBSNR/text() }</column>\n<column name='cBUBKZ'>{ $rs/KNA1/ROW/BUBKZ/text() }</column>\n<column name='cBRSCH'>{ $rs/KNA1/ROW/BRSCH/text() }</column>\n<column name='cJ_1KFREPRE'>{ $rs/KNA1/ROW/J_1KFREPRE/text() }</column>\n<column name='cJ_1KFTIND'>{ $rs/KNA1/ROW/J_1KFTIND/text() }</column>\n<column name='cJ_1KFTIND2'>{ $rs/KNA1/ROW/J_1KFTIND/text() }</column>\n\n<column name='cBANKA'>{ $BNKA/BNKA/ROW/BANKA/text() }</column>\n<column name='cBANKL'>{ $rs/KNBK/ROW/BANKL/text() }</column>\n<column name='cBANKS'>{ $rs/KNBK/ROW/BANKS/text() }</column>\n<column name='cBANKN'>{ $rs/KNBK/ROW/BANKN/text() }</column>\n<column name='cBKONT'>{ $rs/KNBK/ROW/BKONT/text() }</column>\n<column name='cXEZER'>{ $rs/KNBK/ROW/XEZER/text() }</column>\n<column name='cBVTYP'>{ $rs/KNBK/ROW/BVTYP/text() }</column>\n<column name='cSWIFT'>{ $BNKA/BNKA/ROW/SWIFT/text() }</column>\n<column name='cBGRUP'>{ $BNKA/BNKA/ROW/BGRUP/text() }</column>\n<column name='cXPGRO'>{ $BNKA/BNKA/ROW/XPGRO/text() }</column>\n<column name='cBKREF'>{ $rs/KNBK/ROW/BKREF/text()  }</column>\n<column name='cKOINH'>{ $rs/KNBK/ROW/KOINH/text()  }</column>\n<column name='cBRNCH'>{ $BNKA/BNKA/ROW/BRNCH/text() }</column>\n<column name='cIBAN'>{ $TIBAN/TIBAN/ROW/IBAN/text() }</column>\n<column name='cVALID_FROM'>{$TIBAN/TIBAN/ROW/VALID_FROM/text()  }</column>\n\n<column name='cKLIMG'>{ $rs/KNKA/ROW/KLIMG/text() }</column>\n<column name='cKLIME'>{ $rs/KNKA/ROW/KLIME/text() }</column>\n<column name='cWAERS'>{ $rs/KNKA/ROW/WAERS/text() }</column>\n<column name='cDLAUS'>{ $rs/KNKA/ROW/DLAUS/text() }</column>\n\n<column name='cBUKRS2'>{ $rs/KNB1/ROW/BUKRS/text() }</column>\n\n<column name='cSPERR2'>{ $rs/KNB1/ROW/SPERR/text() }</column>\n<column name='cLOEVM2'>{ $rs/KNB1/ROW/LOEVM/text() }</column>\n<column name='cBEGRU2'>{ $rs/KNB1/ROW/BEGRU/text() }</column>\n<column name='cFDGRV'>{ $rs/KNB1/ROW/FDGRV/text() }</column>\n<column name='cFRGRP'>{ $rs/KNB1/ROW/FRGRP/text() }</column>\n<column name='cZUAWA'>{ $rs/KNB1/ROW/ZUAWA/text() }</column>\n<column name='cAKONT'>{ $rs/KNB1/ROW/AKONT/text() }</column>\n<column name='cKNRZE'>{ $rs/KNB1/ROW/KNRZE/text() }</column>\n<column name='cBLNKZ'>{ $rs/KNB1/ROW/BLNKZ/text() }</column>\n\n<column name='cZTERM'>{ $rs/KNB1/ROW/ZTERM/text() }</column>\n<column name='cTOGRU'>{ $rs/KNB1/ROW/TOGRU/text() }</column>\n<column name='cKULTG'>{ $rs/KNB1/ROW/KULTG/text() }</column>\n<column name='cXPORE'>{ $rs/KNB1/ROW/XPORE/text() }</column>\n<column name='cXZVER'>{ $rs/KNB1/ROW/XZVER/text() }</column>\n<column name='cZWELS'>{ $rs/KNB1/ROW/ZWELS/text() }</column>\n<column name='cUZAWE'>{ $rs/KNB1/ROW/UZAWE/text() }</column>\n<column name='cXVERR'>{ $rs/KNB1/ROW/XVERR/text() }</column>\n<column name='cWAKON'>{ $rs/KNB1/ROW/WAKON/text() }</column>\n<column name='cZGRUP'>{ $rs/KNB1/ROW/ZGRUP/text() }</column>\n<column name='cKNRZB'>{ $rs/KNB1/ROW/KNRZB/text() }</column>\n<column name='cHBKID'>{ $rs/KNB1/ROW/HBKID/text() }</column>\n<column name='cREMIT'>{ $rs/KNB1/ROW/REMIT/text() }</column>\n<column name='cWEBTR'>{ $rs/KNB1/ROW/WEBTR/text() }</column>\n<column name='cURLID'>{ $rs/KNB1/ROW/URLID/text() }</column>\n<column name='cZAHLS'>{  $rs/KNB1/ROW/ZAHLS/text() }</column>\n<column name='cLOCKB'>{  $rs/KNB1/ROW/LOCKB/text() }</column>\n<column name='cXEDIP'>{ $rs/KNB1/ROW/XEDIP/text() }</column>\n<column name='cVRSDG'>{  $rs/KNB1/ROW/VRSDG/text() }</column>\n<column name='cSREGL'>{  $rs/KNB1/ROW/SREGL/text() }</column>\n\n<column name='cERNAM2'>{ $rs/KNKK/ROW/ERNAM/text() }</column>\n<column name='cERDAT2'>{ $rs/KNKK/ROW/ERDAT/text() }</column>\n<column name='cAEDAT'>{ $rs/KNKK/ROW/AEDAT/text()}</column>\n<column name='cAETXT'>{ $rs/KNKK/ROW/AETXT/text() }</column>\n<column name='cKKBER'>{ $rs/KNKK/ROW/KKBER/text() }</column>\n<column name='cKNKLI'>{ $rs/KNKK/ROW/KNKLI/text() }</column>\n<column name='cKLIMK'>{ $rs/KNKK/ROW/KLIMK/text() }</column>\n<column name='cWAERS'>{ $rs/KNKK/ROW/WAERS/text() }</column>\n<column name='cSKFOR'>{ $rs/KNKK/ROW/SKFOR/text() }</column>\n<column name='cSSOBL'>{ $rs/KNKK/ROW/SSOBL/text() }</column>\n<column name='cCTLPC'>{ $rs/KNKK/ROW/CTLPC/text() }</column>\n<column name='cSAUFT'>{ $rs/KNKK/ROW/SAUFT/text() }</column>\n<column name='cUEDAT'>{ $rs/KNKK/ROW/UEDAT/text() }</column>\n<column name='cXCHNG'>{ $rs/KNKK/ROW/XCHNG/text() }</column>\n<column name='cDTREV'>{ $rs/KNKK/ROW/DTREV/text() }</column>\n<column name='cNXTRV'>{ $rs/KNKK/ROW/NXTRV/text() }</column>\n<column name='cCRBLB'>{ $rs/KNKK/ROW/CRBLB/text() }</column>\n<column name='cSBGRP'>{ $rs/KNKK/ROW/SBGRP/text() }</column>\n<column name='cGRUPP'>{ $rs/KNKK/ROW/GRUPP/text() }</column>\n<column name='cKRAUS'>{ $rs/KNKK/ROW/KRAUS/text() }</column>\n<column name='cPAYDB'>{ $rs/KNKK/ROW/PAYDB/text() }</column>\n<column name='cDBRAT'>{ $rs/KNKK/ROW/DBRAT/text() }</column>\n<column name='cREVDB'>{ $rs/KNKK/ROW/REVDB/text()  }</column>\n<column name='cAENAM'>{ $rs/KNKK/ROW/AENAM/text() }</column>\n<column name='cSBDAT'>{ $rs/KNKK/ROW/SBDAT/text() }</column>\n<column name='cKDGRP'>{ $rs/KNKK/ROW/KDGRP/text() }</column>\n<column name='cDBPAY'>{ $rs/KNKK/ROW/DBPAY/text() }</column>\n<column name='cDBWAE'>{ $rs/KNKK/ROW/DBWAE/text() }</column>\n<column name='cDBMON'>{ $rs/KNKK/ROW/DBMON/text() }</column>\n<column name='cCPUDT'>{$rs/KNKK/ROW/CPUDT/text() }</column>\n<column name='cDBRTG'>{ $rs/KNKK/ROW/DBRTG/text() }</column>\n<column name='cCASHA'>{ $rs/KNKK/ROW/CASHA/text() }</column>\n<column name='cCASHD'>{ $rs/KNKK/ROW/CASHD/text() }</column>\n\n<column name='cMAHNA'>{ $rs/KNB5/ROW/MAHNA/text() }</column>\n<column name='cMANSP'>{ $rs/KNB5/ROW/MANSP/text() }</column>\n<column name='cMADAT'>{ $rs/KNB5/ROW/MADAT/text() }</column>\n<column name='cKNRMA'>{$rs/KNB5/ROW/KNRMA/text() }</column>\n<column name='cMGRUP'>{ $rs/KNB1/ROW/MGRUP/text() }</column>\n<column name='cMABER'>{ $rs/KNB5/ROW/MABER/text() }</column>\n<column name='cMAHNS'>{ $rs/KNB5/ROW/MAHNS/text() }</column>\n<column name='cGMVDT'>{ $rs/KNB5/ROW/GMVDT/text() }</column>\n<column name='cBUSAB'>{ $rs/KNB5/ROW/BUSAB/text() }</column>\n\n<column name='cZSABE'>{ $rs/KNB1/ROW/ZSABE/text() }</column>\n<column name='cBUSAB2'>{ $rs/KNB1/ROW/BUSAB/text() }</column>\n<column name='cEIKTO'>{ $rs/KNB1/ROW/EIKTO/text()}</column>\n<column name='cXDEZV'>{ $rs/KNB1/ROW/XDEZV/text() }</column>\n<column name='cKVERM'>{ $rs/KNB1/ROW/KVERM/text() }</column>\n<column name='cXAUSZ'>{ $rs/KNB1/ROW/XAUSZ/text() }</column>\n<column name='cPERKZ'>{ $rs/KNB1/ROW/PERKZ/text() }</column>\n\n<column name='cVRSNR'>{ $rs/KNB1/ROW/VRSNR/text() }</column>\n<column name='cVRBKZ'>{  $rs/KNB1/ROW/VRBKZ/text() }</column>\n<column name='cVERDT'>{  $rs/KNB1/ROW/VERDT/text() }</column>\n<column name='cVLIBB'>{  $rs/KNB1/ROW/VLIBB/text() }</column>\n<column name='cVRSZL'>{  $rs/KNB1/ROW/VRSZL/text() }</column>\n<column name='cVRSPR'>{  $rs/KNB1/ROW/VRSPR/text() }</column>\n\n</row>\n\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "S_ALR_87012179 - Customer List",
  "compositionName" : "Set 1"
}