{
  "createdBy" : "sue@iacustomer.com",
  "createdDate" : null,
  "lastModifiedBy" : "sue@iacustomer.com",
  "lastModifiedDate" : null,
  "name" : "f52433fe-c276-4d48-9190-73c8635a9ace",
  "query" : "declare namespace ia = \"urn:x-emc:ia:schema:fn\";\ndeclare namespace table=\"urn:x-emc:ia:schema:table\";\nimport module namespace sias=\"urn:x-sig:sias:util:fn\";\n\n\ndeclare variable $page external;\ndeclare variable $size external;\n\ndeclare variable $sBELNR external;\ndeclare variable $sBUKRS external;\ndeclare variable $sGJAHR external;\n\ndeclare function local:getResultsPage($rows, $page, $size) {\n  let $offset := $page * $size\n  let $total := count($rows)\n  return <results total=\"{ $total }\"> {\n    for $row in subsequence($rows, $offset + 1, $size)\n      return $row\n  } </results>\n};\n\ndeclare function local:addClause($whereClause as xs:string, $var as xs:string*, $expr as xs:string) as xs:string\n{\nif (empty($var) or $var = \"\")\nthen $whereClause\nelse if ($whereClause = \"\") then $expr else concat($whereClause, \" and \", $expr)\n};\n\n(: Build a conditional Where clause :)\nlet $whereClause := local:addClause(\"\", $sBELNR, concat(\"contains($bseg/BELNR, &apos;\", $sBELNR, \"&apos;)\" ))\nlet $whereClause := local:addClause($whereClause, $sBUKRS, concat(\"$bseg/BUKRS = &apos;\", $sBUKRS, \"&apos;\"))\nlet $whereClause := local:addClause($whereClause, $sGJAHR, concat(\"$bseg/GJAHR = &apos;\", $sGJAHR, \"&apos;\"))\nlet $whereClause := if ($whereClause != \"\") then concat(\"where \", $whereClause) else $whereClause\n\nlet $query-str := concat(\"for $bseg in /SAP/BSEG/ROW, $t001 in /SAP/T001/ROW[BUKRS=$bseg/BUKRS] \", $whereClause, \" return <RS><BSEG>{ $bseg }</BSEG><T001>{ $t001 }</T001></RS>\")\n\nlet $main-query := xhive:evaluate($query-str)\nlet $rows := \n\tfor $rs in $main-query\n    let $TXT20 := sias:get_skat($rs/T001/ROW/KTOPL/text(), $rs/BSEG/ROW/HKONT/text(), 'TXT20')\n    let $WRBTR := sias:currency($rs/BSEG/ROW/WRBTR/text(), $rs/BSEG/ROW/SHKZG/text()) \n    let $BUTXT := sias:get_t001($rs/BSEG/ROW/BUKRS/text(), 'BUTXT')\n    let $TXT50 := sias:get_skat($rs/T001/ROW/KTOPL/text(), $rs/BSEG/ROW/HKONT/text(), 'TXT50')  \n\tlet $WAERS := sias:get_t001($rs/BSEG/ROW/BUKRS/text(), 'WAERS')\n    \n    let $HKONT := sias:trimzero($rs/BSEG/ROW/HKONT/text())\n    let $AUFNR := sias:trimzero($rs/BSEG/ROW/AUFNR/text())\n    let $PRCTR := sias:trimzero($rs/BSEG/ROW/PRCTR/text())\n    let $KOSTL := sias:trimzero($rs/BSEG/ROW/KOSTL/text())\n    \nreturn\n\n<row id='{string($rs/BKPF/ROW/@table:id)}'>\n<column name='cBUKRS'>{ $rs/BSEG/ROW/BUKRS/text() }</column>\n<column name='cBUZEI'>{ $rs/BSEG/ROW/BUZEI/text() }</column>\n<column name='cBSCHL'>{ $rs/BSEG/ROW/BSCHL/text() }</column>\n<column name='cUMSKZ'>{ $rs/BSEG/ROW/UMSKZ/text() }</column>\n<column name='cHKONT'>{ $HKONT }</column>\n<column name='cTXT20'>{ $TXT20 }</column>\n<column name='cWRBTR'>{ $WRBTR } { ' ' } { $WAERS } </column> \n<column name='cMWSKZ'>{ $rs/BSEG/ROW/MWSKZ/text() }</column>\n<column name='cKOSTL'>{ $KOSTL }</column>\n<column name='cGSBER'>{ $rs/BSEG/ROW/GSBER/text() }</column>\n<column name='cAUFNR'>{ $AUFNR }</column>\n<column name='cPRCTR'>{ $PRCTR }</column>\n\n<column name='cHKONT2'>{ $HKONT } { ' ' } { $TXT50 }</column>\n<column name='cBUKRS2'>{ $rs/BSEG/ROW/BUKRS/text() } { ' ' } { $BUTXT }</column>\n<column name='cBELNR'>{ $rs/BSEG/ROW/BELNR/text() }</column>\n\n<column name='cDMBTR'>{ $rs/BSEG/ROW/DMBTR/text() } { ' ' } { $WAERS }</column>\n<column name='cMWSKZ'>{ $rs/BSEG/ROW/MWSKZ/text() }</column>\n\n<column name='cAUFNR2'>{ $rs/BSEG/ROW/AUFNR/text() } { ' ' } { $rs/BSEG/ROW/VORNR_AUF/text() }</column>\n<column name='cPARGB'>{ $rs/BSEG/ROW/PARGB/text() }</column>\n<column name='cPS_POSID'>{ $rs/BSEG/ROW/PROJK/text() }</column>\n<column name='cNPLNR'>{ $rs/BSEG/ROW/NPLNR/text() }</column>\n\n\n<column name='cVBEL2'>{ $rs/BSEG/ROW/VBEL2/text() } { ' ' } { $rs/BSEG/ROW/POSN2/text() } { ' ' } { $rs/BSEG/ROW/ETEN2/text() }</column>\n\n\n<column name='cFKBER'>{ $rs/BSEG/ROW/FKBER/text() }</column>\n<column name='cMENGE'>{ $rs/BSEG/ROW/MENGE/text() } { ' ' } { $rs/BSEG/ROW/MEINS/text() }</column>\n<column name='cZFBDT'>{ $rs/BSEG/ROW/ZFBDT/text() }</column>\n<column name='cEBELN'>{ $rs/BSEG/ROW/EBELN/text() } { ' ' } { $rs/BSEG/ROW/EBELP/text() }</column>\n<column name='cZUONR'>{ $rs/BSEG/ROW/ZUONR/text() }</column>\n<column name='cSGTXT'>{ $rs/BSEG/ROW/SGTXT/text() }</column>\n</row>\nreturn local:getResultsPage($rows, $page, $size)",
  "moduleNamespaces" : [ "urn:x-sig:sias:util:fn" ],
  "searchName" : "FB03 - Display Document Line Item",
  "compositionName" : "FB03"
}